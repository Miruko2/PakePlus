(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{2898:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),s=(e,t)=>{let r=(0,n.forwardRef)(({color:r="currentColor",size:s=24,strokeWidth:c=2,absoluteStrokeWidth:u,className:o="",children:l,...d},f)=>(0,n.createElement)("svg",{ref:f,...a,width:s,height:s,stroke:r,strokeWidth:u?24*Number(c)/Number(s):c,className:["lucide",`lucide-${i(e)}`,o].join(" "),...d},[...t.map(([e,t])=>(0,n.createElement)(e,t)),...Array.isArray(l)?l:[l]]));return r.displayName=`${e}`,r}},6264:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(2898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},8490:function(e,t,r){Promise.resolve().then(r.bind(r,3246))},3246:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var n=r(7437),a=r(2265),i=r(2678),s=r(5858),c=r(1657),u=r(2805),o=r(5754),l=r(6264),d=r(6633);function f(e){let{children:t,className:r}=e;return(0,n.jsx)("div",{className:(0,c.cn)("container mx-auto px-4 sm:px-6 max-w-6xl",r),children:t})}var m=r(7815);function v(){let{user:e}=(0,i.a)(),{notifications:t,unreadCount:r,isLoading:v,markAsRead:p,markAllAsRead:x}=(0,s.z)(),[h,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{e||(0,d.T8)("/")},[e]);let w=e=>{try{e.is_read||p(e.id),e.post_id&&(0,d.T8)("/post/".concat(e.post_id))}catch(e){console.error("处理通知点击失败:",e),y("处理通知时出错")}},N=e=>e?e.charAt(0).toUpperCase():"?";return e?(0,n.jsx)(f,{children:(0,n.jsxs)("div",{className:"py-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-white",children:"我的通知"}),r>0&&(0,n.jsx)(o.z,{variant:"outline",className:"text-lime-400 border-lime-400/30 hover:bg-lime-400/10",onClick:()=>{try{x()}catch(e){console.error("标记已读失败:",e),y("标记全部已读失败")}},children:"全部标记为已读"})]}),h&&(0,n.jsx)("div",{className:"text-center py-4 text-red-400 mb-4",children:(0,n.jsx)("p",{children:h})}),v?(0,n.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,n.jsx)(l.Z,{className:"h-6 w-6 animate-spin text-lime-400"}),(0,n.jsx)("span",{className:"ml-2 text-gray-400",children:"加载中..."})]}):t&&t.length>0?(0,n.jsx)("div",{className:"space-y-3",children:t.map(e=>{var t,r,a;let i=(null===(t=e.actor)||void 0===t?void 0:t.username)||"匿名用户",s=null===(r=e.actor)||void 0===r?void 0:r.avatar_url,o=e.message||"新通知",l=e.created_at||new Date().toISOString(),d=null!==(a=e.is_read)&&void 0!==a&&a;return(0,n.jsx)(m.Zb,{className:"".concat(d?"bg-black/20":"bg-lime-950/30"," border-gray-800 hover:bg-gray-800/30 transition-colors cursor-pointer"),onClick:()=>w(e),children:(0,n.jsx)(m.aY,{className:"p-4",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsxs)(u.qE,{className:"h-10 w-10",children:[(0,n.jsx)(u.F$,{src:s||"/placeholder.svg"}),(0,n.jsx)(u.Q5,{className:"bg-lime-950 text-lime-400",children:N(i)})]}),(0,n.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,n.jsx)("p",{className:"leading-tight ".concat(d?"text-gray-300":"text-white"),children:o}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:(0,c.p6)(l)})]})]})})},e.id)})}):(0,n.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,n.jsx)("p",{className:"text-lg",children:"暂无通知"}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"当其他用户点赞或评论你的内容时，会在这里显示通知"})]})]})}):null}},2805:function(e,t,r){"use strict";r.d(t,{F$:function(){return u},Q5:function(){return o},qE:function(){return c}});var n=r(7437),a=r(2265),i=r(1465),s=r(1657);let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(i.fC,{ref:t,className:(0,s.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...a})});c.displayName=i.fC.displayName;let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(i.Ee,{ref:t,className:(0,s.cn)("aspect-square h-full w-full",r),...a})});u.displayName=i.Ee.displayName;let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(i.NY,{ref:t,className:(0,s.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...a})});o.displayName=i.NY.displayName},7815:function(e,t,r){"use strict";r.d(t,{Ol:function(){return c},SZ:function(){return o},Zb:function(){return s},aY:function(){return l},eW:function(){return d},ll:function(){return u}});var n=r(7437),a=r(2265),i=r(1657);let s=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});s.displayName="Card";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...a})});c.displayName="CardHeader";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});u.displayName="CardTitle";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...a})});o.displayName="CardDescription";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...a})});l.displayName="CardContent";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...a})});d.displayName="CardFooter"},5858:function(e,t,r){"use strict";r.d(t,{J:function(){return o},z:function(){return l}});var n=r(7437),a=r(2265),i=r(2926),s=r(747),c=r(1654);let u=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)([]),[l,d]=(0,a.useState)(0),[f,m]=(0,a.useState)(!1),{user:v}=(0,i.d)(),p=(0,a.useRef)(null),x=(0,a.useRef)(0),h=(0,a.useRef)(!0),y=async e=>{if(!v)return!1;let t=Date.now();if(t-x.current<3e3||(x.current=t,!h.current))return!1;m(!0);try{let{notifications:t}=await (0,s.gG)(v.id,e);Array.isArray(t)?o(t):(console.error("返回的通知不是数组:",t),o([]));let r=await (0,s.rj)(v.id);return d(r||0),!0}catch(e){return console.error("获取通知失败:",e),o([]),!1}finally{m(!1)}},w=async e=>{await y(e)},N=async()=>{await y()},g=async e=>{if(v)try{await (0,s.Ix)(e,v.id)&&(o(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),d(e=>Math.max(0,e-1)))}catch(e){console.error("标记通知已读失败:",e)}},j=async()=>{if(v)try{await (0,s.Go)(v.id)&&(o(e=>e.map(e=>({...e,is_read:!0}))),d(0))}catch(e){console.error("标记所有通知已读失败:",e)}};return(0,a.useEffect)(()=>{let e=()=>{let e="visible"===document.visibilityState;h.current=e,e&&y()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),(0,a.useEffect)(()=>{if(!v){o([]),d(0),p.current&&(p.current(),p.current=null);return}let e=function(e,t){let r=null,n=0,a="",i=async function(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let i=Date.now();if(!r&&i-n<5e3)return;n=i;try{(0,s.aY)("profile")}catch(e){}let{notifications:c}=await (0,s.gG)(e),o=u(c);(o!==a||r)&&(a=o,t(c))}catch(e){console.error("获取通知失败:",e)}},u=e=>e&&e.length?e.map(e=>"".concat(e.id,":").concat(e.is_read)).join("|"):"";i(!0);let o=c.OQ.channel("notifications-".concat(e)).on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:"user_id=eq.".concat(e)},()=>{r&&clearTimeout(r),r=setTimeout(async()=>{await i()},500)}).subscribe(e=>{"SUBSCRIBED"!==e&&i(!0)});return()=>{r&&clearTimeout(r),o.unsubscribe()}}(v.id,e=>{o(e),d(e.filter(e=>!e.is_read).length)});return p.current=e,()=>{p.current&&(p.current(),p.current=null)}},[v]),(0,n.jsx)(u.Provider,{value:{notifications:r,unreadCount:l,isLoading:f,fetchNotifications:w,markAsRead:g,markAllAsRead:j,refreshNotifications:N},children:t})}function l(){let e=(0,a.useContext)(u);if(void 0===e)throw Error("useNotifications must be used within a NotificationProvider");return e}},4033:function(e,t,r){e.exports=r(5313)},9808:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(2265),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=n.useState,s=n.useEffect,c=n.useLayoutEffect,u=n.useDebugValue;function o(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(e){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=i({inst:{value:r,getSnapshot:t}}),a=n[0].inst,l=n[1];return c(function(){a.value=r,a.getSnapshot=t,o(a)&&l({inst:a})},[e,r,t]),s(function(){return o(a)&&l({inst:a}),e(function(){o(a)&&l({inst:a})})},[e]),u(r),r};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:l},6272:function(e,t,r){"use strict";e.exports=r(9808)},1465:function(e,t,r){"use strict";r.d(t,{NY:function(){return E},Ee:function(){return b},fC:function(){return j}});var n=r(2265),a=r(6989),i=r(6459),s=r(5655),c=r(9381),u=r(6272);function o(){return()=>{}}var l=r(7437),d="Avatar",[f,m]=(0,a.b)(d),[v,p]=f(d),x=n.forwardRef((e,t)=>{let{__scopeAvatar:r,...a}=e,[i,s]=n.useState("idle");return(0,l.jsx)(v,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:s,children:(0,l.jsx)(c.WV.span,{...a,ref:t})})});x.displayName=d;var h="AvatarImage",y=n.forwardRef((e,t)=>{let{__scopeAvatar:r,src:a,onLoadingStatusChange:d=()=>{},...f}=e,m=p(h,r),v=function(e,{referrerPolicy:t,crossOrigin:r}){let a=(0,u.useSyncExternalStore)(o,()=>!0,()=>!1),i=n.useRef(null),c=a?(i.current||(i.current=new window.Image),i.current):null,[l,d]=n.useState(()=>g(c,e));return(0,s.b)(()=>{d(g(c,e))},[c,e]),(0,s.b)(()=>{let e=e=>()=>{d(e)};if(!c)return;let n=e("loaded"),a=e("error");return c.addEventListener("load",n),c.addEventListener("error",a),t&&(c.referrerPolicy=t),"string"==typeof r&&(c.crossOrigin=r),()=>{c.removeEventListener("load",n),c.removeEventListener("error",a)}},[c,r,t]),l}(a,f),x=(0,i.W)(e=>{d(e),m.onImageLoadingStatusChange(e)});return(0,s.b)(()=>{"idle"!==v&&x(v)},[v,x]),"loaded"===v?(0,l.jsx)(c.WV.img,{...f,ref:t,src:a}):null});y.displayName=h;var w="AvatarFallback",N=n.forwardRef((e,t)=>{let{__scopeAvatar:r,delayMs:a,...i}=e,s=p(w,r),[u,o]=n.useState(void 0===a);return n.useEffect(()=>{if(void 0!==a){let e=window.setTimeout(()=>o(!0),a);return()=>window.clearTimeout(e)}},[a]),u&&"loaded"!==s.imageLoadingStatus?(0,l.jsx)(c.WV.span,{...i,ref:t}):null});function g(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}N.displayName=w;var j=x,b=y,E=N},6989:function(e,t,r){"use strict";r.d(t,{b:function(){return s},k:function(){return i}});var n=r(2265),a=r(7437);function i(e,t){let r=n.createContext(t),i=e=>{let{children:t,...i}=e,s=n.useMemo(()=>i,Object.values(i));return(0,a.jsx)(r.Provider,{value:s,children:t})};return i.displayName=e+"Provider",[i,function(a){let i=n.useContext(r);if(i)return i;if(void 0!==t)return t;throw Error(`\`${a}\` must be used within \`${e}\``)}]}function s(e,t=[]){let r=[],i=()=>{let t=r.map(e=>n.createContext(e));return function(r){let a=r?.[e]||t;return n.useMemo(()=>({[`__scope${e}`]:{...r,[e]:a}}),[r,a])}};return i.scopeName=e,[function(t,i){let s=n.createContext(i),c=r.length;r=[...r,i];let u=t=>{let{scope:r,children:i,...u}=t,o=r?.[e]?.[c]||s,l=n.useMemo(()=>u,Object.values(u));return(0,a.jsx)(o.Provider,{value:l,children:i})};return u.displayName=t+"Provider",[u,function(r,a){let u=a?.[e]?.[c]||s,o=n.useContext(u);if(o)return o;if(void 0!==i)return i;throw Error(`\`${r}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let a=r.reduce((t,{useScope:r,scopeName:n})=>{let a=r(e)[`__scope${n}`];return{...t,...a}},{});return n.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}(i,...t)]}},9381:function(e,t,r){"use strict";r.d(t,{WV:function(){return c},jH:function(){return u}});var n=r(2265),a=r(4887),i=r(7256),s=r(7437),c=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=(0,i.Z8)(`Primitive.${t}`),a=n.forwardRef((e,n)=>{let{asChild:a,...i}=e,c=a?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(c,{...i,ref:n})});return a.displayName=`Primitive.${t}`,{...e,[t]:a}},{});function u(e,t){e&&a.flushSync(()=>e.dispatchEvent(t))}},6459:function(e,t,r){"use strict";r.d(t,{W:function(){return a}});var n=r(2265);function a(e){let t=n.useRef(e);return n.useEffect(()=>{t.current=e}),n.useMemo(()=>(...e)=>t.current?.(...e),[])}},5655:function(e,t,r){"use strict";r.d(t,{b:function(){return a}});var n=r(2265),a=globalThis?.document?n.useLayoutEffect:()=>{}}},function(e){e.O(0,[870,542,243,414,426,971,938,744],function(){return e(e.s=8490)}),_N_E=e.O()}]);