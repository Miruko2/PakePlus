(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{2898:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});var s=t(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),n=(e,r)=>{let t=(0,s.forwardRef)(({color:t="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:d="",children:m,...o},x)=>(0,s.createElement)("svg",{ref:x,...a,width:n,height:n,stroke:t,strokeWidth:c?24*Number(i)/Number(n):i,className:["lucide",`lucide-${l(e)}`,d].join(" "),...o},[...r.map(([e,r])=>(0,s.createElement)(e,r)),...Array.isArray(m)?m:[m]]));return t.displayName=`${e}`,t}},1981:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(2898).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},4280:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(2898).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},9036:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(2898).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},6781:function(e,r,t){Promise.resolve().then(t.bind(t,7739))},7739:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return g}});var s=t(7437),a=t(2678),l=t(2265),n=t(1654),i=t(9036),c=t(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,c.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),m=(0,c.Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var o=t(1981),x=t(4280),h=t(5754),u=t(7815),f=t(5321);function g(){let{user:e,isAdmin:r}=(0,a.a)(),[t,c]=(0,l.useState)(!1),[g,j]=(0,l.useState)(null),[N,p]=(0,l.useState)(null),[y,v]=(0,l.useState)(null),[w,b]=(0,l.useState)(null),k=async()=>{if(e){c(!0);try{let{data:t,error:s}=await n.OQ.from("admin_users").select("id").eq("user_id",e.id).maybeSingle();s?(console.error("直接检查管理员状态错误:",s),p(!1)):(p(!!t),t&&j(t)),v(r);try{let e=localStorage.getItem("userSession");if(e){let r=JSON.parse(e);b(!!r.isAdmin)}else b(!1)}catch(e){console.error("从localStorage读取会话错误:",e),b(!1)}}catch(e){console.error("执行管理员检查时出错:",e)}finally{c(!1)}}};return((0,l.useEffect)(()=>{e&&k()},[e,r]),e)?(0,s.jsx)("div",{className:"container py-10",children:(0,s.jsxs)(u.Zb,{className:"bg-gray-900 border-gray-800 text-white",children:[(0,s.jsxs)(u.Ol,{children:[(0,s.jsxs)(u.ll,{className:"text-lime-400 flex items-center",children:[(0,s.jsx)(i.Z,{className:"h-5 w-5 mr-2"}),"管理员状态检查"]}),(0,s.jsx)(u.SZ,{className:"text-gray-300",children:"此页面可以帮助您确认您的管理员状态是否正确设置"})]}),(0,s.jsxs)(u.aY,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-white",children:"检查结果"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[null===N?(0,s.jsx)("div",{className:"w-5 h-5 mr-2 rounded-full border-2 border-gray-500 border-t-transparent animate-spin"}):N?(0,s.jsx)(d,{className:"h-5 w-5 mr-2 text-green-500"}):(0,s.jsx)(m,{className:"h-5 w-5 mr-2 text-red-500"}),(0,s.jsx)("h4",{className:"font-medium",children:"数据库检查"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:null===N?"正在检查...":N?"您在数据库中被标记为管理员":"您在数据库中不是管理员"})]}),(0,s.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[null===y?(0,s.jsx)("div",{className:"w-5 h-5 mr-2 rounded-full border-2 border-gray-500 border-t-transparent animate-spin"}):y?(0,s.jsx)(d,{className:"h-5 w-5 mr-2 text-green-500"}):(0,s.jsx)(m,{className:"h-5 w-5 mr-2 text-red-500"}),(0,s.jsx)("h4",{className:"font-medium",children:"Context 检查"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:null===y?"正在检查...":y?"AuthContext 中您被标记为管理员":"AuthContext 中您不是管理员"})]}),(0,s.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[null===w?(0,s.jsx)("div",{className:"w-5 h-5 mr-2 rounded-full border-2 border-gray-500 border-t-transparent animate-spin"}):w?(0,s.jsx)(d,{className:"h-5 w-5 mr-2 text-green-500"}):(0,s.jsx)(m,{className:"h-5 w-5 mr-2 text-red-500"}),(0,s.jsx)("h4",{className:"font-medium",children:"localStorage 检查"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:null===w?"正在检查...":w?"localStorage 中您被标记为管理员":"localStorage 中您不是管理员"})]})]})]}),(0,s.jsx)(f.Separator,{className:"bg-gray-800"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-white mb-4",children:"用户信息"}),(0,s.jsx)("div",{className:"bg-gray-800/50 p-4 rounded-lg",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"用户 ID:"}),(0,s.jsx)("p",{className:"text-sm text-gray-200 font-mono",children:e.id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"电子邮箱:"}),(0,s.jsx)("p",{className:"text-sm text-gray-200",children:e.email})]})]})})]}),(0,s.jsx)("div",{className:"bg-gray-800/80 p-4 rounded-lg",children:(0,s.jsx)("div",{className:"flex items-start",children:N&&y&&w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d,{className:"h-5 w-5 text-green-500 mr-2 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-green-400",children:"管理员状态正常"}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:"您的管理员状态已正确设置。您应该能够执行所有管理员操作，包括删除其他用户的帖子。"})]})]}):!N||y&&w?N?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{className:"h-5 w-5 text-yellow-500 mr-2 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-yellow-400",children:"状态不一致"}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:"您的管理员状态不一致。请尝试刷新页面或重新登录以解决此问题。"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m,{className:"h-5 w-5 text-red-500 mr-2 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-red-400",children:"不是管理员"}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:"您在数据库中不是管理员。如果您认为这是错误，请联系系统管理员。"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{className:"h-5 w-5 text-yellow-500 mr-2 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-yellow-400",children:"管理员状态部分正常"}),(0,s.jsx)("p",{className:"text-sm text-gray-300",children:"您在数据库中是管理员，但前端状态不完全一致。请尝试刷新页面或重新登录。"})]})]})})})]}),(0,s.jsx)(u.eW,{children:(0,s.jsx)(h.z,{variant:"outline",className:"bg-lime-950/50 border-lime-800/50 text-lime-400 hover:bg-lime-900/50 hover:text-lime-300",onClick:k,disabled:t,children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"检查中..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"重新检查"]})})})]})}):(0,s.jsx)("div",{className:"container py-10",children:(0,s.jsx)(u.Zb,{className:"bg-gray-900 border-gray-800 text-white",children:(0,s.jsxs)(u.Ol,{children:[(0,s.jsx)(u.ll,{className:"text-red-400",children:"未登录"}),(0,s.jsx)(u.SZ,{className:"text-gray-300",children:"请先登录后再检查管理员状态"})]})})})}},7815:function(e,r,t){"use strict";t.d(r,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return n},aY:function(){return m},eW:function(){return o},ll:function(){return c}});var s=t(7437),a=t(2265),l=t(1657);let n=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});n.displayName="Card";let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...a})});i.displayName="CardHeader";let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});c.displayName="CardTitle";let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",t),...a})});d.displayName="CardDescription";let m=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("p-6 pt-0",t),...a})});m.displayName="CardContent";let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("flex items-center p-6 pt-0",t),...a})});o.displayName="CardFooter"},5321:function(e,r,t){"use strict";t.r(r),t.d(r,{Separator:function(){return m}});var s=t(7437),a=t(2265),l=t(9381),n="horizontal",i=["horizontal","vertical"],c=a.forwardRef((e,r)=>{let{decorative:t,orientation:a=n,...c}=e,d=i.includes(a)?a:n;return(0,s.jsx)(l.WV.div,{"data-orientation":d,...t?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...c,ref:r})});c.displayName="Separator";var d=t(1657);let m=a.forwardRef((e,r)=>{let{className:t,orientation:a="horizontal",decorative:l=!0,...n}=e;return(0,s.jsx)(c,{ref:r,decorative:l,orientation:a,className:(0,d.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",t),...n})});m.displayName=c.displayName},4033:function(e,r,t){e.exports=t(5313)},9381:function(e,r,t){"use strict";t.d(r,{WV:function(){return i},jH:function(){return c}});var s=t(2265),a=t(4887),l=t(7256),n=t(7437),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let t=(0,l.Z8)(`Primitive.${r}`),a=s.forwardRef((e,s)=>{let{asChild:a,...l}=e,i=a?t:r;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(i,{...l,ref:s})});return a.displayName=`Primitive.${r}`,{...e,[r]:a}},{});function c(e,r){e&&a.flushSync(()=>e.dispatchEvent(r))}}},function(e){e.O(0,[870,542,243,414,971,938,744],function(){return e(e.s=6781)}),_N_E=e.O()}]);