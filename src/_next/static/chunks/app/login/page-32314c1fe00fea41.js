(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{7981:function(e,t,s){Promise.resolve().then(s.bind(s,4089))},4089:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var a=s(7437),r=s(2265),n=s(4033),i=s(2926),l=s(5754),o=s(5179),c=s(9842),u=s(5083),d=s(1654),m=s(1396),h=s.n(m),f=s(1657),p=s(8793);function x(){let[e,t]=(0,r.useState)(""),[s,m]=(0,r.useState)(""),[x,g]=(0,r.useState)(!1),[v,y]=(0,r.useState)(null),w=(0,n.useRouter)(),{signIn:b}=(0,i.d)(),{toast:j}=(0,u.pm)(),N=async t=>{if(t.preventDefault(),y(null),!e||!s){y("请填写所有必填字段");return}try{g(!0);let{error:t}=await b(e,s);if(t)console.error("❌ LoginForm: 登录失败:",t.message),y(t.message||"登录失败，请检查您的凭据");else{await new Promise(e=>setTimeout(e,500));let{data:e,error:t}=await d.OQ.auth.getSession();t?console.error("❌ LoginForm: 会话检查失败:",t.message):(null==e?void 0:e.session)?(j({title:"登录成功",description:"您已成功登录"}),w.push("/")):(console.warn("⚠️ LoginForm: 登录成功但会话为空"),j({title:"登录状态异常",description:"请稍后再试",variant:"destructive"}))}}catch(e){console.error("\uD83D\uDCA5 LoginForm: 登录异常:",e.message),y(e.message||"登录过程中发生错误")}finally{g(!1)}};return(0,a.jsxs)("div",{className:"mx-auto max-w-sm space-y-6 p-4",children:[(0,a.jsxs)("div",{className:"space-y-2 text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-lime-400",children:"欢迎回来"}),(0,a.jsx)("p",{className:"text-gray-400",children:"请登录您的账号"})]}),(0,a.jsxs)("form",{id:"login-form",onSubmit:N,className:"space-y-4",children:[v&&(0,a.jsx)("div",{className:"p-3 rounded-md bg-red-900/30 text-red-400 text-sm",children:v}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c._,{htmlFor:"email",children:"邮箱"}),(0,a.jsx)(o.I,{id:"email",type:"email",placeholder:"your@email.com",value:e,onChange:e=>t(e.target.value),required:!0,className:"bg-gray-800/50 border-gray-700 focus:border-lime-500 text-white"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(c._,{htmlFor:"password",children:"密码"}),(0,a.jsx)(h(),{href:"/forgot-password",className:"text-xs text-lime-400 hover:text-lime-300",children:"忘记密码?"})]}),(0,a.jsx)(o.I,{id:"password",type:"password",placeholder:"••••••••",value:s,onChange:e=>m(e.target.value),required:!0,className:"bg-gray-800/50 border-gray-700 focus:border-lime-500 text-white"})]}),(0,a.jsx)(l.z,{type:"submit",className:(0,f.cn)("w-full bg-lime-600 hover:bg-lime-700 text-white"),disabled:x,children:x?(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(p.p6,{size:"sm",color:"text-background"}),(0,a.jsx)("span",{className:"ml-2",children:"登录中..."})]}):"登录"})]}),(0,a.jsxs)("div",{className:"text-center text-sm",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"还没有账号? "}),(0,a.jsx)(h(),{href:"/register",className:"text-lime-400 hover:text-lime-300",children:"立即注册"})]})]})}},5179:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var a=s(7437),r=s(2265),n=s(1657);let i=r.forwardRef((e,t)=>{let{className:s,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...i})});i.displayName="Input"},9842:function(e,t,s){"use strict";s.d(t,{_:function(){return c}});var a=s(7437),r=s(2265),n=s(6743),i=s(6061),l=s(1657);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.f,{ref:t,className:(0,l.cn)(o(),s),...r})});c.displayName=n.f.displayName},8793:function(e,t,s){"use strict";s.d(t,{Mi:function(){return l},nf:function(){return i},p6:function(){return n}});var a=s(7437),r=s(8861);function n(e){let{size:t="md",color:s="text-lime-500",text:n="加载中",showText:i=!1}=e,l={sm:"w-1.5 h-1.5",md:"w-2 h-2",lg:"w-2.5 h-2.5",xl:"w-3 h-3"}[t],o={initial:{y:0},animate:e=>({y:[0,-10,0],transition:{repeat:1/0,repeatType:"loop",duration:1,ease:"easeInOut",delay:.15*e}})};return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat({sm:"h-6",md:"h-8",lg:"h-12",xl:"h-16"}[t]),children:[(0,a.jsx)("div",{className:"flex ".concat({sm:"gap-1.5",md:"gap-2",lg:"gap-3",xl:"gap-4"}[t]," items-center justify-center"),children:[0,1,2].map(e=>(0,a.jsx)(r.E.div,{className:"".concat(l," rounded-full ").concat(s),variants:o,initial:"initial",animate:"animate",custom:e},e))}),i&&(0,a.jsx)("p",{className:"mt-2 ".concat({sm:"text-xs",md:"text-sm",lg:"text-base",xl:"text-lg"}[t]," ").concat(s),children:n})]})}function i(e){let{size:t="md",color:s="text-lime-500",text:n="加载中",showText:i=!1}=e,l={sm:"h-8 w-8",md:"h-12 w-12",lg:"h-16 w-16",xl:"h-20 w-20"}[t],o=s.startsWith("text-")?s.replace("text-","bg-"):s;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,a.jsxs)("div",{className:"relative ".concat(l," flex items-center justify-center"),children:[(0,a.jsx)(r.E.div,{className:"absolute ".concat(l," ").concat(o,"/20 rounded-full"),initial:{scale:.5,opacity:0},animate:{scale:[.5,1.2,.5],opacity:[.2,.6,.2]},transition:{repeat:1/0,duration:2,ease:"easeInOut"}}),(0,a.jsx)(r.E.div,{className:"".concat({sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-10 w-10"}[t]," ").concat(o," rounded-full"),animate:{scale:[.8,1,.8],opacity:[.8,1,.8]},transition:{repeat:1/0,duration:1.5,ease:"easeInOut"}})]}),i&&(0,a.jsx)("p",{className:"mt-3 ".concat({sm:"text-xs",md:"text-sm",lg:"text-base",xl:"text-lg"}[t]," ").concat(s),children:n})]})}function l(e){let{size:t="md",color:s="text-lime-500",text:n="加载中",showText:i=!1}=e,l={sm:"w-4 h-5",md:"w-5 h-6",lg:"w-6 h-8",xl:"w-8 h-10"}[t],o=s.startsWith("text-")?s.replace("text-","bg-"):s,c={initial:e=>({opacity:.3,y:0,rotate:15*e,x:3*e}),animate:e=>({opacity:0===e?[.3,1,.3]:[.3,.7,.3],y:[0,-10,0],rotate:[15*e,15*e+5,15*e],x:[3*e,3*e+2,3*e],transition:{repeat:1/0,duration:2,ease:"easeInOut",delay:.2*e}})};return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,a.jsx)("div",{className:"relative ".concat({sm:"h-12 w-12",md:"h-16 w-16",lg:"h-20 w-20",xl:"h-24 w-24"}[t]," flex items-center justify-center"),children:[0,1,2].map(e=>(0,a.jsx)(r.E.div,{className:"absolute ".concat(l," ").concat(o," rounded-md shadow-lg"),style:{zIndex:3-e,filter:"brightness(".concat(100-15*e,"%)")},variants:c,initial:"initial",animate:"animate",custom:e},e))}),i&&(0,a.jsx)("p",{className:"mt-3 ".concat({sm:"text-xs",md:"text-sm",lg:"text-base",xl:"text-lg"}[t]," ").concat(s),children:n})]})}},2926:function(e,t,s){"use strict";s.d(t,{C:function(){return u},d:function(){return o}});var a=s(7437),r=s(2265),n=s(1654),i=s(5083);let l=(0,r.createContext)({user:null,isAdmin:!1,loading:!0,signIn:async()=>({error:null}),signUp:async()=>({error:null,data:null}),signOut:async()=>{}}),o=()=>(0,r.useContext)(l),c=["99ccec1d-b06d-4019-8ad1-456fb95ac90c"],u=e=>{let{children:t}=e,[s,o]=(0,r.useState)(null),[u,d]=(0,r.useState)(!0),{toast:m}=(0,i.pm)(),h=!!s&&c.includes(s.id);(0,r.useEffect)(()=>{let e=!0,t=async()=>{try{let{data:{session:t},error:s}=await n.OQ.auth.getSession();s&&console.error("❌ SimpleAuth: 获取会话失败:",s.message),e&&((null==t?void 0:t.user)?o(t.user):o(null),d(!1))}catch(t){console.error("\uD83D\uDCA5 SimpleAuth: 初始化失败:",t.message),e&&(o(null),d(!1))}},s=setTimeout(()=>{e&&u&&(console.warn("⚠️ SimpleAuth: 初始化超时，强制结束loading状态"),d(!1))},1e3);return t().finally(()=>{clearTimeout(s)}),()=>{e=!1,clearTimeout(s)}},[]),(0,r.useEffect)(()=>{let{data:{subscription:e}}=n.OQ.auth.onAuthStateChange(async(e,t)=>{(null==t?void 0:t.user)?o(t.user):o(null),d(!1)});return()=>{e.unsubscribe()}},[]);let f=async(e,t)=>{try{var s;let{data:a,error:r}=await n.OQ.auth.signInWithPassword({email:e,password:t});if(r)return console.error("❌ SimpleAuth: 登录失败:",r.message),m({title:"登录失败",description:r.message,variant:"destructive"}),{error:r};return(null===(s=a.session)||void 0===s?void 0:s.user)&&m({title:"登录成功",description:"欢迎回来！"}),{error:null}}catch(e){return console.error("\uD83D\uDCA5 SimpleAuth: 登录异常:",e.message),m({title:"登录失败",description:e.message||"登录过程中发生错误",variant:"destructive"}),{error:e}}},p=async(e,t,s)=>{try{let{data:a,error:r}=await n.OQ.auth.signUp({email:e,password:t,options:{data:{username:s}}});if(r)return console.error("❌ SimpleAuth: 注册失败:",r.message),m({title:"注册失败",description:r.message,variant:"destructive"}),{error:r,data:null};if(!a.user)return console.warn("⚠️ SimpleAuth: 注册成功但未返回用户数据"),{error:null,data:a};try{let{data:e,error:t}=await n.OQ.from("user_profiles").insert([{user_id:a.user.id,username:s}]).select().single();t&&console.error("❌ SimpleAuth: 创建user_profiles记录失败:",t.message)}catch(e){console.error("❌ SimpleAuth: 创建user_profiles异常:",e)}try{let{data:e,error:t}=await n.OQ.from("profiles").insert([{id:a.user.id,username:s,updated_at:new Date().toISOString()}]).select().single();t&&console.error("❌ SimpleAuth: 创建profiles记录失败:",t.message)}catch(e){console.error("❌ SimpleAuth: 创建profiles异常:",e)}try{let{error:e}=await n.OQ.auth.updateUser({data:{username:s,displayName:s}});e&&console.warn("⚠️ SimpleAuth: 更新用户元数据失败:",e.message)}catch(e){console.error("❌ SimpleAuth: 更新用户元数据异常:",e)}return m({title:"注册成功",description:"您的账户已成功创建"}),{data:a,error:null}}catch(e){return console.error("\uD83D\uDCA5 SimpleAuth: 注册异常:",e.message),m({title:"注册失败",description:e.message||"注册过程中发生错误",variant:"destructive"}),{error:e,data:null}}},x=async()=>{try{o(null);let{error:e}=await n.OQ.auth.signOut();e&&console.error("❌ SimpleAuth: 登出失败:",e.message),["sb-session","sb-https-session","sb-auth-token","sb-https-auth-token","supabase.auth.token","supabase:auth:token","auth-session","auth-user","session-data","user-data"].forEach(e=>{try{localStorage.removeItem(e),sessionStorage.removeItem(e)}catch(t){console.warn("清除键".concat(e,"失败:"),t)}});try{for(let e of document.cookie.split(";")){let t=e.split("=")[0].trim();(t.includes("sb-")||t.includes("supabase")||t.includes("auth"))&&(document.cookie="".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;"))}}catch(e){console.warn("清除cookie失败:",e)}await new Promise(e=>setTimeout(e,100)),m({title:"已退出登录",description:"您已成功退出登录"})}catch(e){console.error("\uD83D\uDCA5 SimpleAuth: 登出异常:",e.message),o(null)}};return(0,a.jsx)(l.Provider,{value:{user:s,isAdmin:h,loading:u,signIn:f,signUp:p,signOut:x},children:t})}},1396:function(e,t,s){e.exports=s(5250)},4033:function(e,t,s){e.exports=s(5313)},6743:function(e,t,s){"use strict";s.d(t,{f:function(){return l}});var a=s(2265),r=s(9381),n=s(7437),i=a.forwardRef((e,t)=>(0,n.jsx)(r.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},9381:function(e,t,s){"use strict";s.d(t,{WV:function(){return l},jH:function(){return o}});var a=s(2265),r=s(4887),n=s(7256),i=s(7437),l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let s=(0,n.Z8)(`Primitive.${t}`),r=a.forwardRef((e,a)=>{let{asChild:r,...n}=e,l=r?s:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(l,{...n,ref:a})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function o(e,t){e&&r.flushSync(()=>e.dispatchEvent(t))}}},function(e){e.O(0,[870,542,250,861,243,971,938,744],function(){return e(e.s=7981)}),_N_E=e.O()}]);