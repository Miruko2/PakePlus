(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931,154],{9528:function(e,t,i){Promise.resolve().then(i.bind(i,3187))},3187:function(e,t,i){"use strict";let a,r,s;i.r(t),i.d(t,{default:function(){return eD}});var n=i(7437),l=i(2265),o=i(1981),c=i(290),d=i(1138),u=i(747),m=i(1154),h=i(2926),p=i(5083),x=i(1657),f=i(1149);let g={md:768,xl:1280};function b(){let[e,t]=(0,l.useState)(void 0),i=(0,l.useCallback)(()=>{t(window.innerWidth<g.md)},[]);return(0,l.useEffect)(()=>{i();let e=window.matchMedia("(max-width: ".concat(g.md-1,"px)")),a=e=>{t(e.matches)};return e.addEventListener("change",a),t(e.matches),()=>{e.removeEventListener("change",a)}},[i]),!!e}var w=i(6691),v=i.n(w);function y(e){let{post:t,isMobile:i=!1,disablePreview:a=!1,inDetailView:r=!1,onImageLoad:s}=e,[o,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)(null),p=(0,l.useRef)(null),g=b(),w=i||g,y=!!t.imageContent,j=r?w?85:95:w?40:65,N=()=>{if(r)return"h-[300px]";let e=t.image_ratio||1.5;if(w){if(e<.6)return"h-[240px]";if(e<.8)return"h-[220px]";if(e<1)return"h-[200px]";if(e<1.2)return"h-[180px]";else if(e<1.5)return"h-[160px]";else if(e<1.8)return"h-[150px]";else if(e<2.2)return"h-[140px]";else return"h-[130px]"}if(e<.6)return"h-[350px]";if(e<.8)return"h-[320px]";if(e<1)return"h-[280px]";if(e<1.2)return"h-[250px]";if(e<1.5)return"h-[220px]";if(e<1.8)return"h-[200px]";else if(e<2.2)return"h-[180px]";else return"h-[160px]"},A=(0,l.useCallback)(e=>{let t=e.naturalWidth,i=e.naturalHeight,a=t/i;u(!0),h({width:t,height:i,ratio:a}),s&&s({width:t,height:i,ratio:a})},[s]);if(!t.image_url&&!y)return null;if(y&&!t.image_url)return(0,n.jsx)("div",{className:"image-glow flex items-center justify-center bg-gray-800/60 ".concat(N()," rounded-t-md"),children:(0,n.jsx)("div",{className:"flex flex-col items-center text-white",children:(0,n.jsx)("span",{className:"text-4xl font-light",children:t.imageContent})})});let k=(0,l.useCallback)(()=>{c(!0)},[]);if(o)return(0,n.jsx)("div",{className:"image-glow flex items-center justify-center bg-gray-800/60 ".concat(N()," rounded-t-md"),children:(0,n.jsxs)("div",{className:"flex flex-col items-center text-gray-400",children:[(0,n.jsx)(f.Z,{className:"h-6 w-6 mb-2"}),(0,n.jsx)("span",{className:"text-sm",children:"图片加载失败"})]})});let E=N();return(0,n.jsx)("div",{className:(0,x.cn)("image-glow",r?"detail-view-image":"card-view-image",r?"rounded-t-md overflow-hidden p-0":"rounded-t-md overflow-hidden","contain-content gpu-accelerated","relative",E),children:(0,n.jsx)(v(),{ref:p,src:t.image_url||"",alt:t.title||"帖子图片",className:(0,x.cn)("w-full h-full","object-cover","animation-optimized",r&&"absolute inset-0 m-0"),onLoadingComplete:A,onError:k,quality:j,sizes:r?"(max-width: 768px) 100vw, 70vw":"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",fill:!0,priority:r})})}var j=i(9171),N=i(5863),A=i(2882),k=i(9868),E=i(8861),C=i(1393);function S(e){let{liked:t,count:i,isLoading:a=!1,onClick:r,className:s="",size:o="md"}=e,[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(t);return(0,l.useEffect)(()=>{if(t!==u){d(!0);let e=setTimeout(()=>{d(!1)},700);return m(t),()=>clearTimeout(e)}},[t,u]),(0,n.jsxs)("button",{className:(0,x.cn)("relative flex items-center space-x-1 transition-colors duration-300 rounded-full",t?"text-white bg-white/20":"text-white/80 hover:bg-white/15",a&&"opacity-70 cursor-not-allowed",{sm:"px-2 py-1.5 text-xs",md:"px-3 py-2 text-sm",lg:"px-4 py-2.5 text-base"}[o],s),onClick:r,disabled:a,children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(k.Z,{className:(0,x.cn)({sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"}[o],t&&"fill-current")}),c&&t&&(0,n.jsx)(E.E.div,{initial:{scale:0,opacity:1},animate:{scale:2,opacity:0},transition:{duration:.6},className:"absolute inset-0 bg-lime-400 rounded-full z-0"}),c&&t&&(0,n.jsx)(C.M,{children:[void 0,void 0,void 0].map((e,t)=>(0,n.jsx)(E.E.div,{className:"absolute text-lime-400 text-xs",initial:{y:0,x:(t-1)*10,opacity:1,scale:.2},animate:{y:-20,opacity:0,scale:1.2},transition:{duration:.8+.1*t,ease:"easeOut"},style:{top:"50%",left:"50%"},children:"+1"},t))})]}),(0,n.jsx)("div",{className:"relative h-5 overflow-visible min-w-[16px]",children:(0,n.jsx)(C.M,{mode:"wait",children:(0,n.jsx)(E.E.span,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},transition:{duration:.2},className:"block",children:i},i)})})]})}let _=(0,l.memo)(function(e){let{liked:t,likeCount:i,commentsCount:a,isLiking:r,onLike:s,onComment:o}=e,c=(0,l.useCallback)(e=>{if(e.stopPropagation(),!r){if(window.navigator&&"vibrate"in window.navigator)try{navigator.vibrate(10)}catch(e){}s(e)}},[s,r]),d=(0,l.useCallback)(e=>{e.stopPropagation(),o(e)},[o]);return(0,n.jsxs)("div",{className:"flex items-center gap-2 ml-2",children:[(0,n.jsx)(S,{liked:t,count:i,isLoading:r,onClick:c,size:"sm",className:"py-1 px-2"}),(0,n.jsxs)("button",{className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-black/20 backdrop-blur-sm border border-white/10 text-white/80 hover:bg-white/10 transition-all",onClick:d,"aria-label":"查看评论",children:[(0,n.jsx)(A.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:a})]})]})});function R(e){let{post:t,username:i,isAdmin:a,isAuthor:r,liked:s,likeCount:o,isLiking:c,onLike:d,onComment:u}=e,m=(0,l.useMemo)(()=>t.created_at?(0,j.Q)(new Date(t.created_at),{addSuffix:!0,locale:N.U}):"",[t.created_at]);return(0,n.jsxs)("div",{className:"p-3 pl-2 pt-2 pb-2",children:[(0,n.jsx)("h3",{className:"text-base font-medium text-white mb-1.5 line-clamp-1",title:t.title,children:t.title}),(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2 pl-0",children:[(0,n.jsx)("span",{className:"text-xs font-medium text-white/90 px-2 py-1 bg-black/25 rounded-full -ml-2",children:t.category}),(0,n.jsx)("div",{className:"mr-1",children:(0,n.jsx)(_,{liked:s,likeCount:o,commentsCount:t.comments_count||0,isLiking:c,onLike:d,onComment:u})})]}),(0,n.jsx)("p",{className:"text-sm text-white/80 mb-2 line-clamp-2",title:t.description||t.content,children:t.description||t.content}),(0,n.jsxs)("div",{className:"flex justify-between items-center text-xs text-white/70",children:[(0,n.jsx)("span",{children:i}),(0,n.jsx)("span",{title:new Date(t.created_at).toLocaleString(),children:m})]})]})}_.displayName="PostCardActions";var P=i(2549),T=i(4303),L=i(1720),O=i(4887),I=i(5754),M=i(609),z=i(626),D=i(3093),H=function(e){let{children:t,className:i,intensity:a=20,animate:r=!0,borderGlow:s=!0,dark:o=!1,tiltEffect:c=!1,imageRatio:d,adaptiveHeight:u=!1,wideTemplate:m=!1}=e,[h,p]=(0,l.useState)({x:0,y:0}),[f,g]=(0,l.useState)({width:0,height:0}),[b,w]=(0,l.useState)(!1),[v,y]=(0,l.useState)(!1),j=(0,l.useRef)(null),N=(0,M.c)(0),A=(0,M.c)(0),k=(0,z.q)(N,{stiffness:150,damping:20}),C=(0,z.q)(A,{stiffness:150,damping:20});(0,D.H)(C,[-10,10],["-20%","120%"]),(0,D.H)(k,[-10,10],["120%","-20%"]),(0,l.useEffect)(()=>(y(!0),()=>y(!1)),[]),(0,l.useEffect)(()=>{if(!v)return;let e=()=>{j.current&&g({width:j.current.offsetWidth,height:j.current.offsetHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[v]);let{x:S,y:_}=b&&r?((e,t)=>{if(0===f.width||0===f.height)return{x:50,y:50};let i=e/f.width*100,a=t/f.height*100;if(c&&j.current){let i=f.width/2,a=f.height/2;N.set(-((t-a)/a*6)),A.set((e-i)/i*6)}return{x:Math.max(0,Math.min(100,i)),y:Math.max(0,Math.min(100,a))}})(h.x,h.y):{x:50,y:50},R=o?.15:.08,P=o?"30px":"20px",T=o?.15:.08,L=(()=>{if(!u||!d)return{};let e=window.innerWidth<640;if(m){if(e)return d<1.2?{minHeight:"160px"}:d<1.5?{minHeight:"150px"}:d<1.8?{minHeight:"140px"}:d<2.2?{minHeight:"130px"}:{minHeight:"120px"};return d<1.2?{minHeight:"220px"}:d<1.5?{minHeight:"200px"}:d<1.8?{minHeight:"180px"}:d<2.2?{minHeight:"160px"}:{minHeight:"140px"}}return e?d<.6?{minHeight:"260px"}:d<.8?{minHeight:"240px"}:d<1?{minHeight:"220px"}:{minHeight:"180px"}:d<.6?{minHeight:"350px"}:d<.8?{minHeight:"320px"}:d<1?{minHeight:"280px"}:{minHeight:"220px"}})();return(0,n.jsxs)(E.E.div,{ref:j,className:(0,x.cn)("relative overflow-hidden",i),onMouseMove:e=>{if(!r)return;let t=e.currentTarget.getBoundingClientRect();p({x:e.clientX-t.left,y:e.clientY-t.top})},onMouseEnter:()=>w(!0),onMouseLeave:()=>{w(!1),c&&(N.set(0),A.set(0))},style:{border:"1px solid",borderRadius:"24px",willChange:"transform, backdrop-filter, background, border-color, box-shadow",transformStyle:"preserve-3d",transform:c?"perspective(1000px) rotateX(".concat(k,"deg) rotateY(").concat(C,"deg) translateZ(0)"):"translateZ(0)",...L},initial:{opacity:0,backdropFilter:"blur(".concat(P,")"),background:"rgba(".concat(o?"0, 0, 0":"255, 255, 255",", ").concat(R,")"),borderColor:"rgba(255, 255, 255, ".concat(T,")")},animate:{opacity:1,background:b?"rgba(".concat(o?"0, 0, 0":"255, 255, 255",", ").concat(o?.2:.12,")"):"rgba(".concat(o?"0, 0, 0":"255, 255, 255",", ").concat(R,")"),backdropFilter:b?"blur(".concat(o?"40px":"25px",")"):"blur(".concat(P,")"),borderColor:b?"rgba(255, 255, 255, ".concat(o?.25:.15,")"):"rgba(255, 255, 255, ".concat(T,")"),boxShadow:b?"0 10px 30px rgba(0, 0, 0, 0.3), 0 0 20px rgba(".concat(o?"132, 204, 22":"255, 255, 255",", 0.1)"):"0 4px 20px rgba(0, 0, 0, 0.2)"},transition:{duration:.3,ease:"easeOut"},children:[r&&(0,n.jsx)(E.E.div,{className:"absolute inset-0 pointer-events-none z-0",animate:{background:b?"radial-gradient(circle at ".concat(S,"% ").concat(_,"%, rgba(").concat(o?"30, 30, 30":"255, 255, 255",", 0.15), transparent 70%)"):"none",opacity:b?1:0},transition:{duration:.3,ease:"easeOut"},style:{borderRadius:"inherit"}}),r&&(0,n.jsx)(E.E.div,{className:"absolute inset-0 pointer-events-none z-0 overflow-hidden",style:{borderRadius:"inherit"},children:(0,n.jsx)(E.E.div,{className:"absolute w-[200%] h-[200%] pointer-events-none",animate:{background:b?"linear-gradient(to right, transparent, rgba(255, 255, 255, ".concat(o?.06:.12,"), transparent)"):"none",left:b?["-200%","200%"]:"0%",top:b?["-200%","200%"]:"0%",opacity:b?1:0},transition:{left:{duration:1.5,ease:"easeInOut",repeat:1/0,repeatType:"loop"},top:{duration:1.5,ease:"easeInOut",repeat:1/0,repeatType:"loop"}},style:{transform:"rotate(30deg)"}})}),s&&(0,n.jsx)(E.E.div,{className:"absolute inset-0 pointer-events-none z-0",animate:{boxShadow:b?"inset 0 0 20px rgba(".concat(o?"132, 204, 22":"255, 255, 255",", 0.1)"):"none",opacity:b?1:0},transition:{duration:.4},style:{borderRadius:"inherit"}}),(0,n.jsx)(E.E.div,{className:"absolute inset-0 pointer-events-none z-0",animate:{background:b?"linear-gradient(135deg, rgba(255, 255, 255, ".concat(o?.07:.15,") 0%, transparent 100%)"):"linear-gradient(135deg, rgba(255, 255, 255, ".concat(o?.04:.1,") 0%, transparent 100%)")},transition:{duration:.3},style:{borderRadius:"inherit"}}),(0,n.jsx)(E.E.div,{className:"absolute top-0 left-[5%] right-[5%] h-[1px] pointer-events-none z-0",animate:{background:b?"linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent)":"linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent)",opacity:b?1:.6},transition:{duration:.3}}),(0,n.jsx)("div",{className:"relative z-1",style:{borderRadius:"inherit"},children:t})]})},U=i(2805),W=i(4824);let Z=l.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,n.jsx)("textarea",{className:(0,x.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:t,...a})});Z.displayName="Textarea";var F=i(9882),B=i(6264),Q=i(6020);function Y(e){let{postId:t,parentId:i,onCommentAdded:a,onCancel:r,isReply:s=!1,replyingTo:o,optimized:c=!1,isPinned:d=!1,isAdmin:m=!1}=e,[x,f]=(0,l.useState)(""),[g,b]=(0,l.useState)(!1),{user:w}=(0,h.d)(),{toast:v}=(0,p.pm)(),y=(0,l.useCallback)(async e=>{if(e.preventDefault(),!w){v({title:"请先登录",description:"发表评论前请先登录账号",variant:"destructive"});return}if(d&&!m){v({title:"无权限评论",description:"置顶帖子仅管理员可评论",variant:"destructive"});return}if(!x.trim()){v({title:"评论内容不能为空",variant:"destructive"});return}try{b(!0);let e=x.trim();if(c){f(""),a(null,e),s&&r&&r(),v({title:s?"回复成功":"评论成功",description:s?"您的回复已发布":"您的评论已发布"});try{let r=c?await (0,F.aK)(t,w.id,e,i):await (0,u.Ir)(t,w.id,e,i);a(r)}catch(e){console.error("后台评论提交失败:",e)}}else{let n=await (0,u.Ir)(t,w.id,e,i);f(""),a(n),s&&r&&r(),v({title:s?"回复成功":"评论成功",description:s?"您的回复已发布":"您的评论已发布"})}}catch(t){var n,l,o,h;console.error(s?"发表回复失败:":"发表评论失败:",t);let e="发表时出现错误，请稍后重试";(null===(n=t.message)||void 0===n?void 0:n.includes("JWT"))?e="登录状态已过期，请重新登录":(null===(l=t.message)||void 0===l?void 0:l.includes("RLS"))?e="没有权限发表评论，请检查登录状态":((null===(o=t.message)||void 0===o?void 0:o.includes("network"))||(null===(h=t.message)||void 0===h?void 0:h.includes("fetch")))&&(e="网络连接失败，请检查网络后重试"),v({title:s?"回复失败":"评论失败",description:e,variant:"destructive"})}finally{b(!1)}},[w,x,t,i,s,a,r,v,c,d,m]);return(0,n.jsxs)("form",{onSubmit:y,className:"space-y-3",children:[s&&o&&(0,n.jsx)("div",{className:"flex items-center text-xs text-lime-400 mb-1",children:(0,n.jsxs)("span",{children:["回复给 ",o]})}),(0,n.jsx)(Z,{value:x,onChange:e=>f(e.target.value),placeholder:s?"回复 ".concat(o||"","..."):"写下你的评论...",className:"min-h-[80px] bg-black/30 border-gray-800 focus:border-lime-500/50 text-white focus:ring-lime-500/30 resize-none",disabled:g}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[r&&(0,n.jsx)(I.z,{type:"button",variant:"outline",size:"sm",onClick:r,className:"border-gray-700 text-gray-300 hover:bg-gray-800 hover:text-white",disabled:g,children:"取消"}),(0,n.jsx)(I.z,{type:"submit",size:"sm",className:"bg-lime-500 hover:bg-lime-600 text-black",disabled:g||!x.trim(),children:g?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B.Z,{className:"h-3.5 w-3.5 mr-1 animate-spin"}),c?"发布中...":"发送中..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Q.Z,{className:"h-3.5 w-3.5 mr-1"}),s?"回复":"发表评论"]})})]})]})}var q=i(1654);function V(e){var t,i;let{comment:a,postId:r,onCommentAdded:s,level:o=0,isOptimistic:c=!1,isPinned:d=!1,isAdmin:m=!1}=e,[p,f]=(0,l.useState)(!1),[g,b]=(0,l.useState)(!1),[w,v]=(0,l.useState)(a.likes_count||a.likes||0),[y,j]=(0,l.useState)(!1),{user:N}=(0,h.d)(),A=o<3&&(!d||m),E=(null===(t=a.user)||void 0===t?void 0:t.username)||a.username||"匿名用户",C=(null===(i=a.user)||void 0===i?void 0:i.avatar_url)||"/placeholder.svg?height=32&width=32&query=avatar";(0,l.useEffect)(()=>{N&&!c&&(async()=>{try{let e=await (0,u.Mf)(a.id,N.id);b(!!e)}catch(e){console.error("获取点赞状态失败:",e)}})()},[a.id,N,c]),(0,l.useEffect)(()=>{if(c)return;let e=async()=>{try{let e=await (0,u.aR)(a.id);v(e)}catch(e){console.error("获取评论点赞数失败:",e)}};e();let t=q.OQ.channel("comment-likes-".concat(a.id)).on("postgres_changes",{event:"*",schema:"public",table:"comment_likes",filter:"comment_id=eq.".concat(a.id)},async()=>{e()}).subscribe();return()=>{t.unsubscribe()}},[a.id]);let S=async()=>{if(!N){alert("请先登录后再点赞");return}if(!y&&!c)try{j(!0);let e=!g;b(e),v(t=>e?t+1:Math.max(0,t-1)),e?await (0,u.xG)(a.id,N.id):await (0,u.Gb)(a.id,N.id);let t=await (0,u.aR)(a.id);v(t)}catch(e){console.error("处理评论点赞失败:",e),b(!g),v(e=>g?Math.max(0,e-1):e+1)}finally{j(!1)}};return(0,n.jsx)("div",{className:"p-4 rounded-lg bg-black/20 border border-gray-800/50 ".concat(o>0?"ml-6":""),children:(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsxs)(U.qE,{className:"h-8 w-8",children:[(0,n.jsx)(U.F$,{src:C||"/placeholder.svg"}),(0,n.jsx)(U.Q5,{children:E?E.charAt(0).toUpperCase():"U"})]}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"font-medium text-gray-200",children:E}),(0,n.jsx)("span",{className:"text-xs text-gray-500",children:(0,x.p6)(a.created_at)})]}),(0,n.jsx)("p",{className:"mt-2 text-gray-300",children:a.content}),(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-4",children:[(0,n.jsxs)("button",{className:"flex items-center gap-1 text-xs ".concat(g?"text-lime-500":"text-gray-500 hover:text-lime-500"),onClick:S,disabled:y||!N||c,children:[(0,n.jsx)(k.Z,{className:"h-3.5 w-3.5"}),(0,n.jsx)("span",{children:w})]}),A&&(0,n.jsxs)("button",{onClick:()=>f(!p),className:"flex items-center gap-1 text-xs text-gray-500 hover:text-lime-500",children:[(0,n.jsx)(W.Z,{className:"h-3.5 w-3.5"}),(0,n.jsx)("span",{children:"回复"})]})]}),p&&(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)(Y,{postId:r,parentId:a.id,isReply:!0,replyingTo:E,onCommentAdded:e=>{f(!1),s&&s(e)},onCancel:()=>f(!1),isPinned:d,isAdmin:m})}),a.replies&&a.replies.length>0&&(0,n.jsx)("div",{className:"mt-3 space-y-2",children:a.replies.map(e=>(0,n.jsx)(V,{comment:e,postId:r,onCommentAdded:s,level:o+1,isPinned:d,isAdmin:m},e.id))})]})]})})}var G=i(261),X=i(8784),K=i(4033);function $(e){let{postId:t,onCommentAdded:i,isPinned:a=!1,isAdmin:r=!1}=e,[s,o]=(0,l.useState)([]),[c,d]=(0,l.useState)([]),[m,p]=(0,l.useState)(!0),[x,f]=(0,l.useState)(null),[g,b]=(0,l.useState)(!0),{user:w}=(0,h.d)(),v=(0,K.useRouter)(),y=(0,l.useRef)(null),j=(0,l.useRef)(0),N=(0,l.useRef)(null),A=!a||r,k=(0,l.useCallback)(async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],i=++j.current;try{e&&p(!0),f(null);let a=new Promise((e,t)=>setTimeout(()=>t(Error("获取评论超时")),8e3)),r=(0,u.li)(t),s=await Promise.race([r,a]);i===j.current&&(o(s),b(!0),N.current&&(clearTimeout(N.current),N.current=null))}catch(e){i===j.current&&(console.warn("获取评论失败:",e.message),f("获取评论失败"),b(!1),(e.message.includes("网络")||e.message.includes("超时"))&&(N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{k(!1)},5e3)))}finally{i===j.current&&p(!1)}},[t]),E=(0,l.useCallback)(()=>{let e=!0,i=(0,u.Sv)(t,t=>{e&&(o(e=>{if(e.length!==t.length)return t;let i=new Map(e.map(e=>[e.id,e.content]));return t.some(e=>!i.has(e.id)||i.get(e.id)!==e.content)?t:e}),b(!0),f(null),d(e=>0===e.length?e:e.filter(e=>!!e.isOptimistic||!t.some(t=>t.content.trim()===e.content.trim()&&t.user_id===e.user_id&&t.post_id===e.post_id&&1e4>Math.abs(new Date(t.created_at).getTime()-new Date(e.created_at).getTime())))))});return y.current=()=>{e=!1,i()},y.current},[t]);(0,l.useEffect)(()=>{if(t){k();let e=E();return()=>{e&&e(),N.current&&clearTimeout(N.current)}}},[t,k,E]);let C=()=>"temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),S=(0,l.useCallback)(async(e,a,r)=>{if(w){if(!e&&a){var s;let e=C(),n=()=>{var e;return(null===(e=w.user_metadata)||void 0===e?void 0:e.username)?w.user_metadata.username:w.email?w.email.split("@")[0]:"我"},l={id:e,tempId:e,user_id:w.id,post_id:t,parent_id:r||void 0,content:a.trim(),created_at:new Date().toISOString(),username:n(),user:{id:w.id,username:n(),avatar_url:null===(s=w.user_metadata)||void 0===s?void 0:s.avatar_url},replies:[],likes_count:0,isOptimistic:!0};d(e=>[l,...e]);try{let s=await (0,u.Ir)(t,w.id,a.trim(),r);o(e=>e.some(e=>e.id===s.id)?e:r?e.map(e=>e.id===r?{...e,replies:[s,...e.replies||[]]}:e):[s,...e]),d(t=>t.filter(t=>t.tempId!==e)),i&&i()}catch(t){console.error("[评论列表] 后台提交失败:",t),d(t=>t.filter(t=>t.tempId!==e))}}else e&&i&&i()}},[w,t,i]),_=(e=>{let t=e.length;for(let i of e)i.replies&&i.replies.length>0&&(t+=i.replies.length);return t})((0,l.useCallback)(()=>{let e=[...c,...s],t=new Map;e.forEach(e=>{let i=e.tempId||e.id,a=t.get(i);a?!e.isOptimistic&&a.isOptimistic?t.set(i,e):!a.id.startsWith("temp_")&&e.id.startsWith("temp_")||e.id&&!e.id.startsWith("temp_")&&t.set(i,e):t.set(i,e)});let i=Array.from(t.values()),a=new Map;return i.forEach(e=>{let t="".concat(e.content,"-").concat(e.user_id,"-").concat(e.parent_id||"root"),i=a.get(t);i?!e.id.startsWith("temp_")&&i.id.startsWith("temp_")?a.set(t,e):!e.isOptimistic&&i.isOptimistic&&a.set(t,e):a.set(t,e)}),Array.from(a.values()).sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())},[s,c])())+c.filter(e=>e.isOptimistic).length;return(0,n.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold text-white neon-text flex items-center",children:["评论区",!m&&(0,n.jsxs)("span",{className:"ml-2 text-sm text-gray-400",children:["(",_,")"]})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:g?(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs text-green-400",children:[(0,n.jsx)(G.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:"实时"})]}):(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs text-red-400",children:[(0,n.jsx)(X.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:"离线"})]})})]}),A&&w?(0,n.jsx)(Y,{postId:t,onCommentAdded:S,optimized:!0,isPinned:a,isAdmin:r}):w?a&&!r?(0,n.jsx)("div",{className:"bg-black/30 p-4 rounded-md mt-4 border border-red-500/30",children:(0,n.jsx)("p",{className:"text-center text-sm text-gray-300",children:(0,n.jsx)("span",{className:"text-red-400",children:"置顶帖子仅管理员可评论"})})}):null:(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-4 space-y-2",children:[(0,n.jsx)("p",{className:"text-sm text-gray-400",children:"登录后才能发表评论"}),(0,n.jsx)(I.z,{onClick:()=>{v.push("/login")},variant:"outline",size:"sm",className:"bg-lime-500/10 hover:bg-lime-500/20 border-lime-500/30 text-lime-400",children:"立即登录"})]}),(0,n.jsx)("div",{className:"space-y-4",children:m&&0===s.length&&0===c.length?(0,n.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,n.jsx)(B.Z,{className:"h-6 w-6 text-lime-500 animate-spin"}),(0,n.jsx)("span",{className:"ml-2 text-gray-400",children:"加载评论中..."})]}):x&&0===s.length&&0===c.length?(0,n.jsxs)("div",{className:"p-4 rounded-lg bg-red-900/20 border border-red-900/30",children:[(0,n.jsx)("p",{className:"text-red-400 text-sm",children:x}),(0,n.jsx)(I.z,{onClick:()=>k(),variant:"outline",className:"mt-2 text-xs border-red-900/50 text-red-400 hover:bg-red-900/30",children:"重试"})]}):0===s.length&&0===c.length?(0,n.jsx)("div",{className:"p-6 rounded-lg bg-black/20 border border-gray-800/30 text-center",children:(0,n.jsx)("p",{className:"text-gray-400",children:"暂无评论，来发表第一条评论吧！"})}):(0,n.jsxs)(n.Fragment,{children:[c.map(e=>(0,n.jsx)(V,{comment:e,postId:t,onCommentAdded:S,isOptimistic:!0,isPinned:a,isAdmin:r},e.tempId||e.id)),s.map(e=>(0,n.jsx)(V,{comment:e,postId:t,onCommentAdded:S,isPinned:a,isAdmin:r},e.id))]})})]})}function J(e){let{post:t,isOpen:i,onClose:a,onLike:r,onCommentAdded:s,liked:o,likeCount:c,isLiking:d,username:u,isMobile:m,isAdmin:h=!1,onPostUpdated:x}=e,{toast:f}=(0,p.pm)(),[g,b]=(0,l.useState)(!1),w=async e=>{if(e.stopPropagation(),!g&&h)try{if(b(!0),f({title:"处理中",description:"正在"+(t.isPinned?"取消":"")+"置顶帖子..."}),t.isPinned?await (0,F.Vn)(t.id):await (0,F.wy)(t.id))x&&x(t.id,{isPinned:!t.isPinned}),f({title:"操作成功",description:t.isPinned?"帖子已取消置顶":"帖子已置顶"});else throw Error("操作失败")}catch(e){console.error("置顶操作失败:",e),f({title:"操作失败",description:"置顶操作失败，请稍后重试",variant:"destructive"})}finally{b(!1)}};return(0,O.createPortal)((0,n.jsx)(C.M,{mode:"wait",children:i&&(0,n.jsxs)(E.E.div,{className:"fixed inset-0 z-40 flex items-center justify-center",onClick:a,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[(0,n.jsx)(E.E.div,{className:"absolute inset-0 backdrop-blur-[15px] bg-black/40",initial:{backdropFilter:"blur(0px)",backgroundColor:"rgba(0,0,0,0)"},animate:{backdropFilter:"blur(15px)",backgroundColor:"rgba(0,0,0,0.4)"},exit:{backdropFilter:"blur(0px)",backgroundColor:"rgba(0,0,0,0)"},transition:{duration:.3}}),(0,n.jsxs)(E.E.div,{className:"relative w-full max-w-4xl mx-4 flex flex-col",onClick:e=>e.stopPropagation(),initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",stiffness:300,damping:30},style:{maxHeight:"90vh",zIndex:41},children:[(0,n.jsx)(E.E.button,{onClick:a,className:"absolute -top-12 right-0 z-10 p-2 text-white hover:text-white/80 transition-colors",whileHover:{scale:1.1},whileTap:{scale:.95},children:(0,n.jsx)(P.Z,{className:"h-6 w-6"})}),(0,n.jsxs)(H,{className:"overflow-hidden",dark:!0,intensity:50,animate:!0,borderGlow:!0,imageRatio:t.image_ratio,children:[h&&(0,n.jsx)(E.E.div,{className:"absolute top-4 right-4 z-50",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},children:(0,n.jsx)(I.z,{variant:t.isPinned?"destructive":"outline",size:"sm",className:"flex items-center space-x-1.5 text-xs",onClick:w,disabled:g,children:t.isPinned?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.Z,{className:"h-3 w-3 mr-1"}),"取消置顶"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(L.Z,{className:"h-3 w-3 mr-1"}),"置顶帖子"]})})}),t.isPinned&&(0,n.jsxs)(E.E.div,{className:"absolute top-4 left-0 z-50 bg-red-500 text-white px-3 py-1 rounded-r-md shadow-lg flex items-center",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.3},children:[(0,n.jsx)(L.Z,{className:"h-3.5 w-3.5 mr-1.5"}),"已置顶"]}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:"relative w-full overflow-hidden",children:(0,n.jsx)(y,{post:t,isMobile:m,inDetailView:!0,onImageLoad:e=>{}})}),(0,n.jsxs)("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 300px)"},children:[(0,n.jsxs)(E.E.div,{className:"flex justify-between items-center mb-4",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},children:[(0,n.jsx)(E.E.h3,{className:"text-2xl font-semibold text-white",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},children:t.title}),(0,n.jsx)(E.E.span,{className:"text-white text-sm font-medium px-3 py-1 rounded-full bg-black/25 border border-white/10",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},children:t.category})]}),(0,n.jsxs)(E.E.div,{className:"flex items-center justify-between mb-4 text-sm text-gray-300",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.4},children:[(0,n.jsx)("span",{children:u}),(0,n.jsx)("span",{children:t.created_at?new Date(t.created_at).toLocaleString("zh-CN"):""})]}),(0,n.jsx)(E.E.p,{className:"text-gray-200 text-sm leading-relaxed mb-6 whitespace-pre-line",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.5},children:t.description||t.content}),(0,n.jsx)(E.E.div,{className:"flex justify-between items-center pt-4 border-t border-white/10",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.6},children:(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-gray-300 text-sm",children:[(0,n.jsx)(S,{liked:o,count:c,isLoading:d,onClick:r,size:"md"}),(0,n.jsxs)("div",{className:"flex items-center space-x-1.5 px-3 py-2 rounded-full",children:[(0,n.jsx)(A.Z,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:t.comments_count||0})]})]})}),(0,n.jsx)(E.E.div,{className:"mt-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.7},children:(0,n.jsx)($,{postId:t.id,onCommentAdded:s,isPinned:t.isPinned,isAdmin:h})})]})]})]})]})]})}),document.body)}var ee=i(4118),et=i(3930),ei=i(9752);let ea=(0,l.memo)(function(e){var t;let{post:i,isActive:a=!1,onClick:r,onClose:s,onPostUpdated:x,onPostDeleted:f,userLiked:g,useWideTemplate:w=!1,className:v="",showPinnedBadge:j=!0}=e,[N,A]=(0,l.useState)(!1),[k,C]=(0,l.useState)(g||!1),[S,_]=(0,l.useState)(i.likes_count||0),[P,T]=(0,l.useState)(!1),[L,O]=(0,l.useState)(!1),[I,M]=(0,l.useState)(!1),[z,D]=(0,l.useState)(!1),H=(0,l.useRef)(null),U=(0,l.useRef)(!0),{user:W}=(0,h.d)(),{toast:Z}=(0,p.pm)(),{deletePost:F}=(0,ei.k)(),B=b(),Q=i.username||(null===(t=i.users)||void 0===t?void 0:t.username)||"用户_".concat(i.user_id.substring(0,6)),Y=!!(W&&i.user_id===W.id),q=!!(W&&"4345c6d0-05eb-4bc3-ba50-1cfa1dee2c41"===W.id),V=!!(W&&(Y||q));(0,l.useEffect)(()=>{C(g||!1)},[g]),(0,l.useEffect)(()=>(T(!0),()=>{T(!1),U.current=!1}),[]),(0,l.useEffect)(()=>(a?B?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top="-".concat(window.scrollY,"px")):document.body.style.overflow="hidden":(document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.top=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.top=""}),[a,B]);let G=(0,l.useCallback)(async e=>{if(e.stopPropagation(),!W){Z({title:"请先登录",description:"点赞前请先登录账号",variant:"destructive"});return}if(!L)try{O(!0);let e=!k,t=e?S+1:S-1;C(e),_(t),await new Promise(e=>requestAnimationFrame(()=>e(null))),e?await (0,u.n9)(i.id,W.id):await (0,u.Z6)(i.id,W.id),x&&x(i.id,{likes_count:t})}catch(i){var t,a,r,s;if(!U.current)return;C(!k),_(S);let e="点赞操作失败，请稍后重试";(null===(t=i.message)||void 0===t?void 0:t.includes("JWT"))?e="登录状态已过期，请重新登录":(null===(a=i.message)||void 0===a?void 0:a.includes("RLS"))?e="数据访问权限不足":((null===(r=i.message)||void 0===r?void 0:r.includes("network"))||(null===(s=i.message)||void 0===s?void 0:s.includes("fetch")))&&(e="网络连接失败，请检查网络后重试"),Z({title:"操作失败",description:e,variant:"destructive"})}finally{U.current&&O(!1)}},[W,L,k,S,i.id,x,Z]),X=(0,l.useCallback)(e=>{e.stopPropagation(),!a&&r&&r()},[a,r]),K=(0,l.useCallback)(e=>{!a&&r&&r()},[a,r]),$=(0,l.useCallback)(()=>{x&&x(i.id,{comments_count:(i.comments_count||0)+1})},[i.id,i.comments_count,x]),ea=(0,l.useCallback)(async()=>{if(W&&!I)try{M(!0),a&&s&&s(),Z({title:"正在删除",description:"删除操作进行中..."}),await (0,m.deletePostWithUIUpdate)(i.id,e=>{f&&f(e),F(e)})&&Z({title:"删除成功",description:"帖子已成功删除"})}catch(e){Z({title:"删除失败",description:"删除帖子时出错，请稍后重试",variant:"destructive"}),M(!1),D(!1)}},[W,I,i.id,Z,a,s,f,F]);return(0,n.jsxs)(n.Fragment,{children:[(()=>{let e=B?"mb-0":"mb-6",t=i.isPinned?"pinned-post":"";return(0,n.jsxs)(E.E.div,{ref:H,className:"post-card glass-card will-change-transform ".concat(e," ").concat(w?"wide-template":"tall-template"," ").concat(t," ").concat(v),onClick:K,onMouseEnter:()=>A(!0),onMouseLeave:()=>A(!1),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:260,damping:20,duration:.3},style:{position:"relative",zIndex:1,marginTop:B?"-25px":"0",...w&&B?{marginLeft:"-2%",width:"104%"}:{}},children:[i.isPinned&&j&&(0,n.jsxs)("div",{className:"absolute top-2 left-0 z-20 bg-red-500 text-white px-2 py-0.5 rounded-r-md text-xs font-medium shadow-md flex items-center",children:[(0,n.jsx)(er,{className:"h-3 w-3 mr-1"})," 置顶"]}),q&&(0,n.jsxs)("div",{className:"absolute top-2 left-2 z-10 bg-red-500/30 backdrop-blur-md text-white text-xs px-2 py-1 rounded-md flex items-center gap-1",children:[(0,n.jsx)(o.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{children:"管理员"})]}),V&&(0,n.jsxs)(et.h_,{children:[(0,n.jsx)(et.$F,{className:"absolute top-2 right-2 z-10 p-1.5 bg-black/30 backdrop-blur-md text-white/80 rounded-lg hover:bg-black/40",children:(0,n.jsx)(c.Z,{className:"h-4 w-4"})}),(0,n.jsx)(et.AW,{align:"end",children:(0,n.jsxs)(et.Xi,{onClick:e=>{e.stopPropagation(),D(!0)},className:"text-red-400 hover:text-red-300",children:[(0,n.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"删除帖子"]})})]}),(0,n.jsx)("div",{className:"image-container relative overflow-hidden",children:(0,n.jsx)(y,{post:i,isMobile:B,disablePreview:!0,onImageLoad:e=>{i.image_ratio!==e.ratio&&e.ratio}})}),(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)(R,{post:i,username:Q,isAdmin:q,isAuthor:Y,liked:k,likeCount:S,isLiking:L,onLike:G,onComment:X})})]})})(),P?(0,n.jsx)(J,{post:i,isOpen:a,onClose:s||(()=>{}),onLike:G,onCommentAdded:$,liked:k,likeCount:S,isLiking:L,username:Q,isMobile:B,isAdmin:q,onPostUpdated:x}):null,(0,n.jsx)(ee.aR,{open:z,onOpenChange:D,children:(0,n.jsxs)(ee._T,{children:[(0,n.jsxs)(ee.fY,{children:[(0,n.jsx)(ee.f$,{children:"确认删除"}),(0,n.jsx)(ee.yT,{children:"你确定要删除这个帖子吗？这个操作不可撤销，所有评论也将被删除。"})]}),(0,n.jsxs)(ee.xo,{children:[(0,n.jsx)(ee.le,{children:"取消"}),(0,n.jsx)(ee.OL,{onClick:ea,disabled:I,className:"bg-red-500 hover:bg-red-600 text-white",children:I?"删除中...":"确认删除"})]})]})})]})});function er(e){return(0,n.jsxs)("svg",{...e,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("line",{x1:"12",y1:"17",x2:"12",y2:"22"}),(0,n.jsx)("path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"})]})}var es=i(4702),en=i(8793),el=e=>{let{children:t,isVisible:i,delay:a=0,className:r,skipBlur:s=!1}=e,[o,c]=(0,l.useState)(!1),d=(0,l.useRef)(i);return((0,l.useEffect)(()=>{if(i&&!d.current?d.current=!0:i||d.current,i){let e=setTimeout(()=>{c(!0)},1e3);return()=>clearTimeout(e)}},[i]),s||o)?(0,n.jsx)("div",{className:r,children:t}):(0,n.jsxs)(E.E.div,{className:(0,x.cn)("relative overflow-hidden will-change-auto",r),initial:{opacity:0,filter:s?"blur(0px)":"blur(10px)"},animate:{opacity:i?1:0,filter:i||s?"blur(0px)":"blur(10px)",y:i?0:20},transition:{opacity:{duration:.6,delay:a},filter:{duration:.7,delay:a+.1,ease:"easeOut"},y:{duration:.5,delay:a,ease:"easeOut"}},children:[t,(0,n.jsx)(E.E.div,{className:"absolute inset-0 bg-gradient-to-b from-transparent to-background/80 backdrop-blur-sm pointer-events-none",initial:{opacity:.8},animate:{opacity:i?0:.8},transition:{duration:.8,delay:a+.2}})]})};function eo(e,t){let i=null,a=0;return function(){for(var r=arguments.length,s=Array(r),n=0;n<r;n++)s[n]=arguments[n];let l=Date.now(),o=t-(l-a);o<=0||o>t?(i&&(clearTimeout(i),i=null),a=l,e.apply(this,s)):i||(i=setTimeout(()=>{a=Date.now(),i=null,e.apply(this,s)},o))}}function ec(e){let{posts:t=[],loadMorePosts:i,hasMore:a=!1,loading:r=!1,activePostId:s=null,onPostClick:o,onPostClose:c,onPostUpdated:d,onPostDeleted:u,pageSize:m=30}=e,[h,p]=(0,l.useState)(null),[x,f]=(0,l.useState)(0),w=b(),v=(0,l.useRef)(!0),[y,j]=(0,es.YD)({threshold:.1,triggerOnce:!1}),N=(0,l.useRef)(0),A=(0,l.useRef)(!1),k=(0,l.useRef)(null),[C,S]=(0,l.useState)(null),[_,R]=(0,l.useState)(0),[P,T]=(0,l.useState)(new Set),L=(0,l.useRef)(!1),O=(0,l.useRef)(new Set([0])),I=(0,l.useRef)(0),M=(0,l.useRef)("down"),z=(0,l.useRef)(0),[D,H]=(0,l.useState)({width:window.innerWidth,height:window.innerHeight}),[U,W]=(0,l.useState)(0),[Z,F]=(0,l.useState)({start:0,end:0}),[B,Q]=(0,l.useState)({}),[Y,q]=(0,l.useState)(new Set),[V,G]=(0,l.useState)(!1),X=(0,l.useRef)(0),K=(0,l.useRef)(0),$=w?2:3,J=w?1.5:1,ee=w?.01:.02,et=(0,l.useRef)(!1);(0,l.useEffect)(()=>{v.current=!0;let e=eo(()=>{v.current&&H({width:window.innerWidth,height:window.innerHeight})},100),t=eo(()=>{if(v.current&&!et.current){let e=Date.now(),t=window.scrollY;e-X.current<200?G(Math.abs(t-K.current)/(e-X.current)>1.5):G(!1),X.current=e,K.current=t,W(t)}},w?150:100);return window.addEventListener("resize",e),window.addEventListener("scroll",t),()=>{v.current=!1,window.removeEventListener("resize",e),window.removeEventListener("scroll",t)}},[t,w]),(0,l.useEffect)(()=>{et.current=null!==s},[s]);let{columnData:ei,columnHeights:er,postPositions:ec}=(0,l.useMemo)(()=>{try{S(null);let e=3;window.innerWidth<g.xl&&(e=2);let i=Array(e).fill(null).map(()=>[]),a=Array(e).fill(0),r={};if(!Array.isArray(t)||0===t.length)return{columnData:i,columnHeights:a,postPositions:r};let s=t.filter(e=>!e||!e.id);s.length>0&&console.error("发现无效帖子:",s.length);let n=new Set,l=window.innerWidth<640,o=l?-20:30;return t.forEach(e=>{var t,s,c;if(!e||!e.id||n.has(e.id))return;n.add(e.id);let d=e.image_ratio||1.5,u=0,m=0;m=d<.6?400:d<.8?360:d<1?320:d<1.2?280:d<1.5?240:d<1.8?220:d<2.2?180:160,u+=m;let h=(null===(t=e.title)||void 0===t?void 0:t.length)||0,p=(null===(s=e.description)||void 0===s?void 0:s.length)||(null===(c=e.content)||void 0===c?void 0:c.length)||0;u+=Math.max(24,24*Math.ceil(h/25))+20*Math.min(3,Math.ceil(p/40))+48+(l?30:64);let x=a.indexOf(Math.min(...a));r[e.id]=a[x],i[x].push(e),a[x]+=u+o}),{columnData:i,columnHeights:a,postPositions:r}}catch(t){console.error("瀑布流布局计算失败:",t),S("布局计算失败，请刷新页面重试");let e=3;return window.innerWidth<g.xl&&(e=2),{columnData:Array(e).fill(null).map(()=>[]),columnHeights:Array(e).fill(0),postPositions:{}}}},[t,D]);(0,l.useEffect)(()=>{if(et.current||0===ei.length)return;let e=setTimeout(()=>{let e=U+D.height,t=D.height*J,i=U-D.height*$,a=e+D.height*$,r=Math.max(0,U-t),s=e+t;F(e=>Math.abs(e.start-r)>100||Math.abs(e.end-s)>100?{start:r,end:s}:e);let n=Date.now(),l={...B},o=new Set(Y),c=!1;Object.entries(ec).forEach(t=>{let[d,u]=t,m=u+500,h=u<e&&m>U,p=l[d]||{isVisible:!1,hasAppeared:!1,enteredViewportAt:null};u<i||u>a?o.has(d)||(o.add(d),c=!0):o.has(d)&&(o.delete(d),p.hasAppeared=!1,p.enteredViewportAt=null,c=!0),h&&!p.isVisible?(p.isVisible=!0,p.enteredViewportAt=n,c=!0):!h&&p.isVisible&&(p.isVisible=!1,c=!0),p.enteredViewportAt&&n-p.enteredViewportAt>1e3&&(p.hasAppeared=!0),u<s&&m>r||h?l[d]=p:l[d]&&(delete l[d],c=!0)}),c&&(Q(l),q(o))},w?100:50);return()=>clearTimeout(e)},[U,D,ei,ec,w,B,Y,$]),(0,l.useEffect)(()=>{let e=eo(()=>{let e=window.scrollY;e<z.current?M.current="up":e>z.current&&(M.current="down"),z.current=e},100);return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);let ed=(0,l.useCallback)(()=>{if(!i||"function"!=typeof i)return Promise.resolve();let e=_+1;return O.current.has(e)?(R(e),Promise.resolve()):i(e,m).then(()=>{R(e),O.current.add(e),e>I.current&&(I.current=e)}).catch(e=>{console.error("加载更多帖子时出错:",e)})},[i,m,_]),eu=(0,l.useCallback)(()=>{if(!i||"function"!=typeof i||!a)return Promise.resolve();let e=I.current+1;return P.has(e)||O.current.has(e)||L.current?Promise.resolve():(L.current=!0,i(e,m).then(()=>{T(t=>{let i=new Set(t);return i.add(e),i}),O.current.add(e),I.current=e}).catch(t=>{console.error("预加载第 ".concat(e," 页内容时出错:"),t)}).finally(()=>{L.current=!1}))},[i,m,P,a,_]);(0,l.useEffect)(()=>{if(!v.current||r)return;let e=setTimeout(()=>{eu()},1e3);return()=>clearTimeout(e)},[_,r,eu]),(0,l.useEffect)(()=>{if(!v.current||!j||!a||r||A.current||"up"===M.current)return;A.current=!0;let e=!1;return(async()=>{try{await ed()}finally{!e&&v.current&&(A.current=!1)}})(),()=>{e=!0}},[j,a,r,ed]),(0,l.useEffect)(()=>{if(!v.current)return;let e=eo(()=>{if("up"===M.current)window.scrollY,window.innerHeight,document.documentElement.scrollHeight},w?200:150);return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[_,w]);let em=null!==s?s:h,eh=(0,l.useCallback)(e=>{v.current&&(N.current=window.scrollY||0,et.current=!0,o?o(e):p(e))},[o]),ep=(0,l.useCallback)(()=>{if(!v.current)return;window.scrollY;let e=N.current;et.current=!1,c?c():p(null),e>0&&(w?setTimeout(()=>{/^((?!chrome|android).)*safari/i.test(navigator.userAgent),window.scrollTo({top:e,behavior:"auto"})},10):window.scrollTo({top:e,behavior:"auto"}))},[c,w]),ex=(0,l.useCallback)((e,t)=>{d&&d(e,t)},[d]),ef=(0,l.useCallback)(e=>{u&&u(e)},[u]),eg=(0,l.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=w?200:0;return e>=Z.start-i&&e<=Z.end+i||e+t>=Z.start-i&&e<=Z.end+i},[Z,w]),eb=(0,l.useCallback)(e=>B[e]||{isVisible:!1,hasAppeared:!1,enteredViewportAt:null},[B]),ew=(0,l.useCallback)(e=>Y.has(e),[Y]);return((0,l.useEffect)(()=>{t.some(e=>e.isPinned)&&f(e=>e+1)},[t]),r&&(!Array.isArray(t)||0===t.length))?(0,n.jsx)("div",{className:"flex justify-center items-center h-32 w-full",children:(0,n.jsx)(en.nf,{})}):C?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-10 text-center w-full",children:[(0,n.jsx)("div",{className:"text-3xl mb-4 text-red-500",children:"⚠️"}),(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2 text-red-400",children:C}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md",children:"刷新页面"})]}):Array.isArray(t)&&0!==t.length?(0,n.jsxs)("div",{className:"w-full",ref:k,children:[(0,n.jsx)("div",{className:"relative w-full",style:{height:"".concat(Math.max(...er)+(w?150:100),"px"),minHeight:"50vh"},children:ei.map((e,t)=>(0,n.jsx)("div",{className:"absolute top-0",style:{width:"calc(".concat(100/ei.length,"% - ").concat(ei.length>1?"0.75rem":"0px",")"),left:"calc(".concat(100/ei.length*t,"% + ").concat(t>0?"0.75rem":"0px",")")},children:e.map((e,i)=>{if(!e||!e.id)return null;try{let a=ec[e.id]||0,r=ew(e.id),s=!r&&eg(a,500),l="col-".concat(t,"-post-").concat(e.id).concat(e.isPinned?"-pinned":""),{isVisible:o,hasAppeared:c}=eb(e.id);if(r||!s)return(0,n.jsx)("div",{className:"post-placeholder",style:{position:"absolute",top:w?"".concat(Math.max(0,a-15*i),"px"):"".concat(a,"px"),width:"100%",height:"".concat(500,"px")},"data-postid":e.id},l);return(0,n.jsx)(E.E.div,{className:"w-full post-card-container",initial:{opacity:0,y:20},animate:{opacity:1,y:w?-15:0,scale:e.isPinned?1.01:1},transition:{type:"spring",stiffness:e.isPinned?280:260,damping:e.isPinned?18:20,duration:.3,delay:e.isPinned?0:.05*i},style:{position:"absolute",top:w?"".concat(Math.max(0,a-15*i),"px"):"".concat(a,"px"),width:w&&e.image_ratio?e.image_ratio>=1?"110%":"95%":"100%",left:w&&e.image_ratio&&e.image_ratio>=1?"-5%":"0",zIndex:e.isPinned?w?20:15:w?10-i%10:Math.max(1,9-i%10),paddingBottom:w?"0px":"15px",transform:w?"translateY(-10px)":"none",boxShadow:e.isPinned?"0 4px 12px rgba(0, 0, 0, 0.08)":"none"},children:(0,n.jsx)(el,{isVisible:o||c||!!e.isPinned,delay:e.isPinned?0:Math.min(.5,i*ee),className:"w-full",skipBlur:!!e.isPinned,children:(0,n.jsx)(ea,{post:e,isActive:em===e.id,onClick:()=>eh(e.id),onClose:ep,onPostUpdated:ex,onPostDeleted:ef,useWideTemplate:!!e.image_ratio&&e.image_ratio>=1})})},l)}catch(e){return console.error("渲染帖子错误:",e),null}})},"column-".concat(t)))}),(0,n.jsxs)("div",{ref:y,className:"flex justify-center items-center py-4 mt-2",children:[r&&(0,n.jsx)("div",{className:"flex justify-center items-center h-16 my-2",children:(0,n.jsx)(en.nf,{})}),!r&&a&&(0,n.jsx)("div",{className:"h-6 flex items-center justify-center text-sm text-gray-400",children:"上滑加载更多..."})]})]},"virtual-list-".concat(x)):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-center w-full",children:[(0,n.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDF31"}),(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"还没有帖子"}),(0,n.jsx)("p",{className:"text-gray-500 max-w-md",children:'成为第一个发布帖子的人！点击右下角的"+"按钮创建新帖子。'})]})}var ed=i(2678),eu=i(2894),em=i(4280);function eh(){let[e,t]=(0,l.useState)(null),{user:i}=(0,ed.a)(),{state:a,loadMorePosts:r,updatePost:s,deletePost:o,retryLoading:c}=(0,ei.k)(),{posts:d,isLoading:u,hasMore:m,error:h}=a,p=(0,l.useCallback)((e,t)=>r(e,t),[r]),x=(0,l.useCallback)(e=>{let i=window.scrollY||document.documentElement.scrollTop||0;"undefined"!=typeof sessionStorage&&(sessionStorage.setItem("forumScrollPosition",i.toString()),sessionStorage.setItem("modalOpen","true")),t(e)},[]),f=(0,l.useCallback)(()=>{t(null),"undefined"!=typeof sessionStorage&&sessionStorage.removeItem("modalOpen")},[]),g=(0,l.useCallback)((e,t)=>{s(e,t)},[s]),b=(0,l.useCallback)(i=>{o(i),e===i&&t(null)},[o,e]),w=(0,l.useCallback)(()=>{c()},[c]);return(0,n.jsxs)("div",{className:"post-grid-container w-full max-w-7xl mx-auto pb-20",children:[u&&0===d.length&&(0,n.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,n.jsx)(en.nf,{})}),h&&(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center mx-auto px-4",children:[(0,n.jsxs)("div",{className:"flex items-center mb-4 text-red-500",children:[(0,n.jsx)(eu.Z,{className:"mr-2"}),(0,n.jsx)("span",{children:"加载出错"})]}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:h}),(0,n.jsxs)(I.z,{onClick:w,variant:"outline",size:"sm",className:"flex items-center",children:[(0,n.jsx)(em.Z,{className:"w-4 h-4 mr-2"}),"重试加载"]})]}),d.length>0&&(0,n.jsx)(E.E.div,{className:"post-grid-layout w-full px-4",layout:!0,initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:(0,n.jsx)(ec,{posts:d,loadMorePosts:p,hasMore:m,loading:u,activePostId:e,onPostClick:x,onPostClose:f,onPostUpdated:g,onPostDeleted:b,pageSize:30})}),!u&&!h&&0===d.length&&(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[(0,n.jsx)("p",{className:"text-xl mb-4",children:"暂无帖子"}),(0,n.jsx)("p",{className:"text-sm",children:"成为第一个发帖的人吧"})]})]})}var ep=i(9883),ex=i(8438),ef=i(5179),eg=i(9842),eb=i(6633);function ew(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1200,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1200,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8;return new Promise((r,s)=>{if(!e.type.startsWith("image/")){s(Error("不是有效的图片文件"));return}let n=new FileReader;n.onload=n=>{var l;if(!(null===(l=n.target)||void 0===l?void 0:l.result)){s(Error("读取文件失败"));return}let o=new Image;o.onload=()=>{let n=o.width,l=o.height,c=!1;if(n>t&&(l=l*t/n,n=t,c=!0),l>i&&(n=n*i/l,l=i,c=!0),!c&&("image/jpeg"===e.type||"image/webp"===e.type)&&e.size<=1048576){r(e);return}let d=document.createElement("canvas");d.width=Math.round(n),d.height=Math.round(l);let u=d.getContext("2d");if(!u){s(Error("创建Canvas上下文失败"));return}u.drawImage(o,0,0,n,l);let m="image/png"===e.type?"image/png":"image/jpeg";d.toBlob(t=>{if(!t){s(Error("Canvas转换失败"));return}r(new File([t],e.name,{type:m,lastModified:Date.now()}))},m,a)},o.onerror=()=>{s(Error("图片加载失败"))},o.src=n.target.result},n.onerror=()=>{s(Error("文件读取失败"))},n.readAsDataURL(e)})}async function ev(e){try{let t=await new Promise((t,i)=>{let a=new FileReader;a.onload=e=>{var a;if(!(null===(a=e.target)||void 0===a?void 0:a.result)){i(Error("读取文件失败"));return}let r=new Image;r.onload=()=>{t({width:r.width,height:r.height})},r.onerror=()=>{i(Error("图片加载失败"))},r.src=e.target.result},a.onerror=()=>{i(Error("文件读取失败"))},a.readAsDataURL(e)}),i=t.height/t.width,a=await ew(e,400,400,.6),r=await ew(e,1600,1600,.85),s=URL.createObjectURL(a),n=URL.createObjectURL(r);return{thumbnailFile:a,optimizedFile:r,thumbnailUrl:s,originalUrl:n,originalWidth:t.width,originalHeight:t.height,aspectRatio:i}}catch(e){throw console.error("图片处理失败:",e),e}}var ey=i(1094);let ej=new Map,eN={webp:null,avif:null},eA=(a=null,()=>{if(null!==a)return a;if("undefined"==typeof document)return!1;try{let e=document.createElement("canvas");if(e.getContext&&e.getContext("2d"))return a=0===e.toDataURL("image/webp").indexOf("data:image/webp")}catch(e){}return a=!1,!1}),ek=(r=null,s=!1,()=>{if(null!==r)return r;if(!s){s=!0;try{let e=new window.Image;e.onload=()=>{r=!0},e.onerror=()=>{r=!1},e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="}catch(e){r=!1}}return r||!1}),eE=null,eC=0,eS=()=>{let e=Date.now();if(eE&&e-eC<1e4)return eE;if("undefined"==typeof navigator)return eE="fast","fast";let t=navigator.connection;if(!t)return eE="fast","fast";if(t.saveData)return eE="slow","slow";let i=t.effectiveType;return eE="slow-2g"===i||"2g"===i?"slow":"3g"===i?"medium":"fast",eC=e,eE},e_=(0,l.memo)(e=>{let{src:t,alt:i,className:a,aspectRatio:r,priority:s=!1,width:o,height:c,thumbnailSrc:d,previewable:u=!1,preserveOriginal:m=!1,quality:h=70,onImageLoad:p,onError:g,stopPropagation:b=!1,previewZIndex:w=50,preserveRatio:y=!1,fitMode:j="cover",lowQualityInBackground:N=!0,blurLevel:A=8,loadingIndicator:k="pulse",placeholderColor:S="#1e293b"}=e,[_,R]=(0,l.useState)(!0),[T,L]=(0,l.useState)(!1),[O,I]=(0,l.useState)(d||t),[M,z]=(0,l.useState)(!1),[D,H]=(0,l.useState)(!1),[U,W]=(0,l.useState)(r||1),[Z,F]=(0,l.useState)(!1),[B,Q]=(0,l.useState)("fast"),[Y,q]=(0,l.useState)(1),V=(0,l.useRef)(null),G=(0,l.useRef)(null),X=(0,l.useRef)(!1),K=(0,l.useRef)(!0),$=(0,l.useRef)(0);(0,l.useEffect)(()=>{{q(window.devicePixelRatio||1);let e=window.matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)")),t=()=>{q(window.devicePixelRatio||1)};return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}}},[]),(0,l.useEffect)(()=>{let e=()=>{Q(eS())};return e(),"undefined"!=typeof navigator&&navigator.connection&&navigator.connection.addEventListener("change",e),s||setTimeout(()=>{let e=performance.now(),t=new window.Image;t.onload=()=>{let t=performance.now()-e;t>500?Q("slow"):t>200&&Q("medium")},t.src="/favicon.ico?test="+new Date().getTime()},0),()=>{"undefined"!=typeof navigator&&navigator.connection&&navigator.connection.removeEventListener("change",e)}},[s]),(0,l.useEffect)(()=>{if(s){F(!0);return}let e=new IntersectionObserver(t=>{let[i]=t;i.isIntersecting&&(F(!0),e.disconnect())},{rootMargin:"300px",threshold:.01});return G.current&&e.observe(G.current),()=>{e.disconnect()}},[s]),(0,l.useEffect)(()=>(I(d||t),R(!0),z(!1),L(!1),X.current=!1,()=>{K.current=!1}),[t,d]);let J=(0,l.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||e.startsWith("data:")||e.startsWith("blob:")||!(!e.includes(".svg")&&!e.includes(".gif")))return e;let i=new URL(e,window.location.href),a=i.origin!==window.location.origin;if(i.searchParams.has("format")||a&&!e.includes("unsplash.com")&&!e.includes("picsum.photos")&&!e.includes("placeholder"))return e;let r=h;t?r=Math.max(85,h):("slow"===B?r=Math.max(40,h-35):"medium"===B&&(r=Math.max(50,h-20)),N&&(r=Math.max(30,r-25)));let s=o?Math.round(o*Y):void 0;s&&("slow"===B?s=Math.round(.6*s):"medium"===B&&(s=Math.round(.8*s)));let n={};s&&!i.searchParams.has("width")&&(n.width=s.toString()),n.quality=r.toString();let l=async()=>{let t=await ek(),a=eA();return(t?n.format="avif":a&&(n.format="webp"),Object.entries(n).forEach(e=>{let[t,a]=e;i.searchParams.set(t,a)}),K.current)?i.toString():e};return!0===eN.avif?n.format="avif":!0===eN.webp&&(n.format="webp"),Object.entries(n).forEach(e=>{let[t,a]=e;i.searchParams.set(t,a)}),null===eN.avif&&null===eN.webp&&l().then(e=>{K.current&&!M&&I(e)}),i.toString()},[Y,M,N,B,h,t,o]);(0,l.useEffect)(()=>{if(!d||T||!K.current||!Z)return;if($.current=performance.now(),ej.has(t)){L(!0),I(t),R(!1);let e=ej.get(t);!r&&e&&e.width&&e.height&&W(e.height/e.width),X.current||(X.current=!0,null==p||p()),performance.now(),$.current;return}let e=J(t,!0),i=new window.Image;i.src=e,i.onload=()=>{K.current&&(L(!0),I(e),R(!1),!r&&i.width&&i.height&&W(i.height/i.width),ej.set(t,i),performance.now(),$.current,X.current||(X.current=!0,null==p||p()))},i.onerror=()=>{K.current&&(d?R(!1):(z(!0),R(!1),null==g||g()),console.error("图片加载失败: ".concat(t)))}},[t,d,r,T,p,g,Z,B,J]);let ee=(0,l.useCallback)(e=>{R(!1),!r&&e.currentTarget.naturalWidth&&e.currentTarget.naturalHeight&&W(e.currentTarget.naturalHeight/e.currentTarget.naturalWidth),X.current||(X.current=!0,null==p||p())},[r,p]),et=(0,l.useCallback)(()=>{z(!0),R(!1),I("/placeholder.svg?height=400&width=600&query=图片加载失败"),null==g||g()},[g]),ei=()=>{H(!1),document.body.style.overflow=""},{sizes:ea,quality:er}=(()=>{let e="";{let t=window.innerWidth;e=t<=640?"100vw":t<=1024?"50vw":"(max-width: 1536px) 33vw, 25vw"}let t=h;return"slow"===B?t=Math.max(50,h-30):"medium"===B&&(t=Math.max(60,h-15)),{sizes:e,quality:t}})();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{ref:G,className:(0,x.cn)("relative overflow-hidden",_&&"pulse"===k&&"animate-pulse bg-gray-700/50",u&&!M&&"cursor-zoom-in",a),style:r&&!y?{aspectRatio:String(r)}:void 0,onClick:e=>{u&&(b&&e.stopPropagation(),u&&!M&&(H(!0),document.body.style.overflow="hidden"))},children:[(Z||s)&&(0,n.jsx)(E.E.div,{initial:{opacity:0},animate:{opacity:M?0:1,filter:_||!T&&d?"blur(".concat(A,"px)"):"blur(0px)"},transition:{duration:.5},className:"w-full h-full",children:(0,n.jsx)(v(),{src:J(O||"/placeholder.svg",T),alt:i,fill:!0,width:0,height:0,className:(0,x.cn)("transition-all duration-300",_?"scale-105":"scale-100","contain"===j?"object-contain":"fill"===j?"object-fill":"object-cover"),onLoad:ee,onError:et,priority:s,quality:er,sizes:ea,ref:V})}),(()=>{if(!_||"none"===k)return null;switch(k){case"pulse":default:return(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(en.Mi,{size:"md",color:"text-lime-400"})});case"skeleton":return(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-800/50 to-gray-700/50 animate-pulse",style:{backgroundColor:S}});case"spinner":return(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("div",{className:"h-8 w-8 border-4 border-t-lime-400 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}})(),M&&(0,n.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gray-800/40 text-gray-300",children:[(0,n.jsx)(f.Z,{className:"h-8 w-8 mb-2"}),(0,n.jsx)("p",{className:"text-xs",children:"图片加载失败"})]})]}),(0,n.jsx)(C.M,{children:D&&(0,n.jsx)(E.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[".concat(w,"] bg-black/90 flex items-center justify-center"),onClick:ei,children:(0,n.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh]",onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)(v(),{src:J(t,!0),alt:i,width:1200,height:1200,className:(0,x.cn)("max-w-[90vw] max-h-[90vh] rounded-lg object-contain",m?"w-auto h-auto":"w-full h-full"),quality:95,priority:!0}),(0,n.jsx)("button",{onClick:ei,className:"absolute top-3 right-3 bg-black/60 text-white p-2 rounded-full hover:bg-black/80 transition-colors",children:(0,n.jsx)(P.Z,{className:"h-6 w-6"})}),(0,n.jsx)("div",{className:"absolute bottom-3 right-3 bg-black/60 text-white p-2 rounded-full",children:(0,n.jsx)(ey.Z,{className:"h-6 w-6"})})]})})})]})});function eR(e){let{onClose:t,onPostCreated:i}=e,[a,r]=(0,l.useState)(""),[s,o]=(0,l.useState)(""),[c,d]=(0,l.useState)(""),[m,x]=(0,l.useState)(null),[f,g]=(0,l.useState)(null),[b,w]=(0,l.useState)(null),[v,y]=(0,l.useState)(null),[j,N]=(0,l.useState)(!1),[A,k]=(0,l.useState)(!1),[C,S]=(0,l.useState)(!1),_=(0,l.useRef)(null),R=(0,l.useRef)(null),T=(0,l.useRef)(""),{user:L}=(0,h.d)(),{toast:I}=(0,p.pm)(),[M,z]=(0,l.useState)(.75),[D,H]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e;N(!0),T.current=document.body.style.overflow,document.body.style.overflow="hidden",H(window.innerWidth<=768);let t=()=>{clearTimeout(e),e=setTimeout(()=>{H(window.innerWidth<768)},100)};return window.addEventListener("resize",t),()=>{N(!1),document.body.style.overflow=T.current,window.removeEventListener("resize",t),clearTimeout(e)}},[]),(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t]);let U=async e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];if(i){if(i.size>10485760){I({title:"文件过大",description:"图片大小不能超过10MB",variant:"destructive"});return}try{S(!0);let{thumbnailUrl:e,originalUrl:t,optimizedFile:a,aspectRatio:r}=await ev(i);if(g(e),x(t),w(i),y(a),r)z(r);else{let e=new Image;e.onload=()=>{let t=e.height/e.width;z(t)},e.src=t}S(!1)}catch(e){console.error("图片处理失败:",e),I({title:"图片处理失败",description:"无法处理所选图片，请尝试其他图片",variant:"destructive"}),S(!1)}}},W=async e=>{try{let t=v||e,i=t.name.split(".").pop(),a="".concat(Math.random().toString(36).substring(2,15),".").concat(i),{data:r,error:s}=await q.OQ.storage.from("post-images").upload("".concat(a),t,{cacheControl:"3600",upsert:!1});if(s)throw console.error("图片上传错误详情:",s),s;let{data:n}=q.OQ.storage.from("post-images").getPublicUrl(r.path);return n.publicUrl}catch(e){throw console.error("图片上传错误:",e),Error("图片上传失败: ".concat(e.message))}};(0,l.useEffect)(()=>()=>{m&&m.startsWith("blob:")&&URL.revokeObjectURL(m),f&&f.startsWith("blob:")&&URL.revokeObjectURL(f)},[m,f]);let F=async()=>{if(!L){I({title:"请先登录",description:"发布帖子前请先登录账号",variant:"destructive"});return}if(!s.trim()||!a.trim()||!c.trim()){I({title:"信息不完整",description:"请填写标题、分类和内容",variant:"destructive"});return}try{let e;if(k(!0),b)try{e=await W(b)}catch(e){console.error("[发帖] 图片上传过程中出错:",e),I({title:"图片上传失败",description:"错误: ".concat(e.message||"未知错误"),variant:"destructive"}),k(!1);return}let t=M;(M<=0||!Number.isFinite(M))&&(t=1),await (0,u.qb)({title:s,category:c,description:a,content:a,image_url:e,image_ratio:t}),window.clearSupabaseCache&&window.clearSupabaseCache(),I({title:"发布成功",description:"您的帖子已成功发布"}),setTimeout(()=>{i()},800)}catch(t){console.error("[发帖] 发布帖子失败:",t);let e="发布帖子时出现错误，请稍后重试";t.message&&(e=t.message),(0,eb.pE)()&&t.message.includes("网络")&&(e+="\n\n在移动应用中，请确保网络连接稳定。"),I({title:"发布失败",description:e,variant:"destructive"})}finally{k(!1)}};return j?(0,O.createPortal)((0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:t,children:[(0,n.jsx)(E.E.div,{className:"absolute inset-0 bg-black/60 backdrop-blur-md",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3}}),(0,n.jsxs)(E.E.div,{ref:R,className:"relative max-w-2xl w-full max-h-[90vh] overflow-y-auto m-4 rounded-xl shadow-[0_10px_40px_rgba(0,255,120,0.2)] backdrop-blur-xl",onClick:e=>e.stopPropagation(),style:{maxHeight:D?"85vh":"90vh",width:D?"calc(100% - 32px)":"600px"},variants:{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:20,stiffness:100}},float:{y:[0,-7,0],rotate:[0,.5,0],transition:{y:{repeat:1/0,duration:6,ease:"easeInOut"},rotate:{repeat:1/0,duration:6,ease:"easeInOut"}}},exit:{opacity:0,scale:.9,y:20,transition:{duration:.3,ease:"easeInOut"}}},initial:"initial",animate:["animate","float"],exit:"exit",children:[(0,n.jsxs)("div",{className:"absolute inset-0 rounded-xl overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-xl"}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/5 via-transparent to-lime-500/5"}),(0,n.jsxs)("div",{className:"absolute inset-0 opacity-30",children:[(0,n.jsx)("div",{className:"absolute -top-40 -left-40 w-80 h-80 rounded-full bg-green-500/20 blur-3xl"}),(0,n.jsx)("div",{className:"absolute -bottom-40 -right-40 w-80 h-80 rounded-full bg-emerald-500/20 blur-3xl"})]}),(0,n.jsx)("div",{className:"absolute inset-0 rounded-xl border border-white/10"}),(0,n.jsx)("div",{className:"absolute top-0 left-10 right-10 h-[1px] bg-gradient-to-r from-transparent via-green-400/40 to-transparent"})]}),(0,n.jsxs)("div",{className:"p-6 relative z-10",children:[(0,n.jsx)(E.E.h3,{className:"text-xl font-semibold mb-6 inline-block",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:(0,n.jsx)("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-green-300 to-emerald-400",children:"创建新帖子"})}),(0,n.jsxs)("div",{className:"space-y-5",children:[(0,n.jsxs)(E.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},children:[(0,n.jsx)(eg._,{htmlFor:"post-title",className:"text-green-300 mb-1.5 block font-medium",children:"标题"}),(0,n.jsx)(ef.I,{id:"post-title",value:s,onChange:e=>o(e.target.value),placeholder:"输入帖子标题...",className:"bg-white/5 backdrop-blur-md border-white/10 focus:border-green-400/30 text-white placeholder:text-white/30 focus:ring-green-400/20 rounded-lg",disabled:A,required:!0})]}),(0,n.jsxs)(E.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},children:[(0,n.jsx)(eg._,{htmlFor:"post-category",className:"text-green-300 mb-1.5 block font-medium",children:"分类"}),(0,n.jsx)(ef.I,{id:"post-category",value:c,onChange:e=>d(e.target.value),placeholder:"输入帖子分类...",className:"bg-white/5 backdrop-blur-md border-white/10 focus:border-green-400/30 text-white placeholder:text-white/30 focus:ring-green-400/20 rounded-lg",disabled:A,required:!0})]}),(0,n.jsxs)(E.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.5},children:[(0,n.jsx)(eg._,{htmlFor:"post-description",className:"text-green-300 mb-1.5 block font-medium",children:"内容"}),(0,n.jsx)(Z,{id:"post-description",value:a,onChange:e=>r(e.target.value),placeholder:"分享你的想法...",className:"min-h-[150px] bg-white/5 backdrop-blur-md border-white/10 focus:border-green-400/30 text-white placeholder:text-white/30 focus:ring-green-400/20 rounded-lg",disabled:A,required:!0})]}),(0,n.jsxs)("div",{className:"mt-4 relative",children:[m&&(0,n.jsxs)(E.E.div,{className:"relative rounded-lg overflow-hidden border border-white/10 backdrop-blur-sm bg-white/5",style:{minHeight:"150px",maxHeight:"250px",height:M>1?"250px":"auto"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,n.jsx)(e_,{src:m,thumbnailSrc:f||void 0,alt:"预览图片",className:"w-full h-full object-contain",aspectRatio:M,previewable:!0,preserveRatio:!1,fitMode:"contain"}),(0,n.jsx)(E.E.button,{type:"button",className:"absolute top-2 right-2 bg-black/30 backdrop-blur-md rounded-full p-1.5 hover:bg-black/50",onClick:()=>{m&&m.startsWith("blob:")&&URL.revokeObjectURL(m),f&&f.startsWith("blob:")&&URL.revokeObjectURL(f),x(null),g(null),w(null),y(null),_.current&&(_.current.value="")},whileHover:{scale:1.1},whileTap:{scale:.95},children:(0,n.jsx)(P.Z,{className:"h-4 w-4 text-white"})})]}),C&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm rounded-lg",children:(0,n.jsx)("div",{className:"flex flex-col items-center",children:(0,n.jsx)(en.nf,{size:"lg",color:"text-green-300",showText:!0,text:"优化图片中..."})})})]}),(0,n.jsx)("input",{type:"file",ref:_,onChange:U,accept:"image/*",className:"hidden",id:"image-upload",disabled:A}),(0,n.jsxs)(E.E.div,{className:"flex justify-between pt-3 sticky bottom-0 backdrop-blur-xl pb-1 mt-5",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.6},children:[(0,n.jsxs)(E.E.button,{type:"button",onClick:()=>{var e;return null===(e=_.current)||void 0===e?void 0:e.click()},className:"flex items-center gap-2 py-2 px-4 rounded-full bg-white/5 backdrop-blur-md border border-white/10 text-green-300 hover:bg-white/10 transition-colors",disabled:A||C,whileHover:{scale:1.03,backgroundColor:"rgba(255,255,255,0.1)"},whileTap:{scale:.97},children:[(0,n.jsx)(ex.Z,{className:"h-4 w-4"}),"上传图片"]}),(0,n.jsx)(E.E.button,{type:"button",onClick:F,className:"flex items-center gap-2 py-2 px-6 rounded-full bg-gradient-to-r from-green-400/80 to-emerald-500/80 backdrop-blur-md text-white font-medium shadow-lg shadow-green-500/20 disabled:opacity-50 disabled:pointer-events-none",disabled:A||!s.trim()||!a.trim()||!c.trim()||C,whileHover:{scale:1.05,boxShadow:"0 8px 20px rgba(0, 200, 100, 0.3)"},whileTap:{scale:.97},children:A?(0,n.jsx)("div",{className:"flex flex-col items-center justify-center p-1",children:(0,n.jsx)(en.nf,{size:"sm",color:"text-white",showText:!0,text:"发布中..."})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Q.Z,{size:16}),(0,n.jsx)("span",{children:"发布帖子"})]})})]})]})]})]})]}),document.body):null}function eP(e){let{onPostCreated:t}=e,[i,a]=(0,l.useState)(!1),{user:r}=(0,h.d)(),s=(0,K.useRouter)(),{toast:o}=(0,p.pm)(),c=async()=>{if(!r){o({title:"请先登录",description:"发布帖子前请先登录账号"}),s.push("/login");return}a(!0)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(I.z,{className:"fixed bottom-6 right-6 w-14 h-14 rounded-full bg-lime-500 hover:bg-lime-600 text-black shadow-lg hover:shadow-lime-500/30 hover:scale-110 transition-all duration-300 backdrop-blur-sm gpu-accelerated z-[999]",style:{zIndex:999},onClick:c,children:[(0,n.jsx)(ep.Z,{className:"h-6 w-6"}),(0,n.jsx)("span",{className:"absolute inset-0 rounded-full bg-lime-400/20 animate-ping animation-optimized"})]}),i&&(0,n.jsx)(eR,{onClose:()=>a(!1),onPostCreated:()=>{a(!1),t?t():o({title:"发布成功",description:"帖子已发布，正在刷新列表...",duration:3e3})}})]})}e_.displayName="ProgressiveImage";var eT=i(7712),eL=i(8868);function eO(e){let{children:t,animation:i="fade",delay:a=0,duration:r=.5,className:s="",threshold:o=.2,once:c=!0}=e,d=(0,eT._)(),u=(0,l.useRef)(null),m=(0,eL.Y)(u,{amount:o,once:c}),[h,p]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{m&&!h&&(d.start("visible"),c&&p(!0)),m||c||!h||(d.start("hidden"),p(!1))},[m,d,c,h]),(0,n.jsx)(E.E.div,{ref:u,initial:"hidden",animate:d,variants:{hidden:{opacity:0,y:"slide-up"===i?50:0,x:"slide-right"===i?-50:0,scale:"scale"===i?.8:1},visible:{opacity:1,y:0,x:0,scale:1,transition:{duration:r,delay:a,ease:"bounce"===i?"backOut":"easeOut"}}},className:s,children:t})}class eI{static async inspectTableStructure(e){try{let{data:t,error:i}=await q.OQ.from(e).select("*").limit(1);if(i)return console.error('❌ 无法访问表 "'.concat(e,'":'),i),{tableName:e,accessible:!1,error:i.message,errorCode:i.code};return{tableName:e,accessible:!0,sampleData:null==t?void 0:t[0],recordCount:(null==t?void 0:t.length)||0}}catch(t){return console.error('\uD83D\uDCA5 检查表 "'.concat(e,'" 时出错:'),t),{tableName:e,accessible:!1,error:t.message}}}static async checkUserPermissions(){try{let{data:{session:e},error:t}=await q.OQ.auth.getSession();if(t)return console.error("❌ 获取会话失败:",t),{hasSession:!1,error:t.message};if(!e)return console.warn("⚠️ 未找到活跃会话"),{hasSession:!1,message:"用户未登录"};return{hasSession:!0,userId:e.user.id,email:e.user.email,userMetadata:e.user.user_metadata,sessionExpiry:e.expires_at}}catch(e){return console.error("\uD83D\uDCA5 检查用户权限时出错:",e),{hasSession:!1,error:e.message}}}static async testOperationPermissions(e){let t={canReadPosts:!1,canCreatePost:!1,canReadComments:!1,canCreateComment:!1,canReadLikes:!1,canCreateLike:!1,canReadProfiles:!1,canCreateProfile:!1};try{let{data:e,error:i}=await q.OQ.from("posts").select("id, title, user_id").limit(1);i||(t.canReadPosts=!0)}catch(e){}try{let i={title:"TEST_POST_"+Date.now(),content:"This is a test post for permission checking",description:"Test description",category:"test",user_id:e,likes:0,comments:0},{error:a}=await q.OQ.from("posts").insert([i]).select();a||(t.canCreatePost=!0,await q.OQ.from("posts").delete().eq("title",i.title))}catch(e){}try{let{data:e,error:i}=await q.OQ.from("comments").select("id, content, user_id").limit(1);i||(t.canReadComments=!0)}catch(e){}try{let{data:e,error:i}=await q.OQ.from("likes").select("id, user_id, post_id").limit(1);i||(t.canReadLikes=!0)}catch(e){}try{let{data:e,error:i}=await q.OQ.from("profiles").select("id, username, email").limit(1);i||(t.canReadProfiles=!0)}catch(e){}return t}static async checkRLSStatus(){try{let e={};for(let t of["posts","comments","likes","profiles"])try{let{error:i}=await q.OQ.from(t).select("*").limit(0);e[t]={accessible:!i,error:null==i?void 0:i.message,code:null==i?void 0:i.code}}catch(i){e[t]={accessible:!1,error:i.message}}return e}catch(e){return console.error("检查RLS状态失败:",e),{error:e.message}}}static async generateDatabaseReport(){let e={timestamp:new Date().toISOString(),userPermissions:await this.checkUserPermissions(),rlsStatus:await this.checkRLSStatus(),tableStructures:{},operationPermissions:null};for(let t of["posts","comments","likes","profiles"])e.tableStructures[t]=await this.inspectTableStructure(t);return e.userPermissions.hasSession&&e.userPermissions.userId&&(e.operationPermissions=await this.testOperationPermissions(e.userPermissions.userId)),e}static async quickHealthCheck(){let e=Date.now();try{let{data:t,error:i}=await q.OQ.from("posts").select("count").limit(1),a=Date.now()-e;if(i)return{healthy:!1,duration:a,error:i.message,code:i.code};return{healthy:!0,duration:a,canAccessPosts:!0}}catch(t){return{healthy:!1,duration:Date.now()-e,error:t.message}}}}async function eM(){try{let{data:e,error:t}=await q.OQ.from("comment_likes").select("count").limit(1);t&&"42P01"===t.code?await ez():t&&(console.warn("检查表时出现其他错误:",t),await ez())}catch(e){console.error("处理评论点赞表时出错:",e),await ez()}}async function ez(){try{let{error:e}=await q.OQ.rpc("create_comment_likes_table");if(e){console.warn("使用RPC创建评论点赞表失败，尝试直接SQL创建:",e);let{error:t}=await q.OQ.from("comment_likes").insert({id:"temp_init_record",comment_id:"temp",user_id:"temp",created_at:new Date().toISOString()}).select();t&&"42P01"===t.code&&localStorage.setItem("comment_likes_table_sql",'\n          CREATE TABLE IF NOT EXISTS public.comment_likes (\n            id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,\n            comment_id UUID NOT NULL,\n            user_id UUID NOT NULL,\n            created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),\n            UNIQUE(comment_id, user_id)\n          );\n          \n          -- 添加安全策略\n          ALTER TABLE public.comment_likes ENABLE ROW LEVEL SECURITY;\n          CREATE POLICY "评论点赞可被已认证用户创建" ON public.comment_likes FOR INSERT TO authenticated WITH CHECK (true);\n          CREATE POLICY "评论点赞可被创建者删除" ON public.comment_likes FOR DELETE TO authenticated USING (auth.uid() = user_id);\n          CREATE POLICY "评论点赞对所有人可见" ON public.comment_likes FOR SELECT USING (true);\n        ')}}catch(e){console.error("创建评论点赞表时出错:",e)}}function eD(){let{loading:e,user:t}=(0,h.d)();(0,l.useEffect)(()=>{!async function(){try{await eM()}catch(e){console.error("初始化数据库结构失败:",e)}}()},[]);let i={position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundImage:"repeating-linear-gradient(\n      0deg,\n      rgba(0, 0, 0, 0.15),\n      rgba(0, 0, 0, 0.15) 2px,\n      rgba(0, 0, 0, 0.03) 2px,\n      rgba(0, 0, 0, 0.03) 4px\n    )",pointerEvents:"none",zIndex:0,backdropFilter:"blur(0.7px)"};return e?(0,n.jsxs)("div",{className:"min-h-screen relative flex items-center justify-center",children:[(0,n.jsx)("div",{style:i}),(0,n.jsxs)("div",{className:"text-center space-y-4 relative z-10",children:[(0,n.jsx)(B.Z,{className:"h-8 w-8 animate-spin text-lime-400 mx-auto"}),(0,n.jsx)("p",{className:"text-gray-400",children:"正在加载..."})]})]}):(0,n.jsxs)("div",{className:"min-h-screen relative",children:[(0,n.jsx)("div",{style:i}),(0,n.jsx)("main",{className:"container mx-auto px-4 pt-24 pb-8 max-w-4xl z-10 relative",children:(0,n.jsx)(eO,{animation:"fade",children:(0,n.jsx)("section",{className:"mb-8",children:(0,n.jsx)(eh,{})})})}),(0,n.jsx)(eP,{})]})}window.DatabaseInspector=eI,window.checkDatabase=()=>eI.generateDatabaseReport(),window.quickDbCheck=()=>eI.quickHealthCheck()},4118:function(e,t,i){"use strict";i.d(t,{OL:function(){return f},_T:function(){return u},aR:function(){return o},f$:function(){return p},fY:function(){return m},le:function(){return g},xo:function(){return h},yT:function(){return x}});var a=i(7437),r=i(2265),s=i(5943),n=i(1657),l=i(5754);let o=s.fC;s.xz;let c=s.h_,d=r.forwardRef((e,t)=>{let{className:i,...r}=e;return(0,a.jsx)(s.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...r,ref:t})});d.displayName=s.aV.displayName;let u=r.forwardRef((e,t)=>{let{className:i,...r}=e;return(0,a.jsxs)(c,{children:[(0,a.jsx)(d,{}),(0,a.jsx)(s.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...r})]})});u.displayName=s.VY.displayName;let m=e=>{let{className:t,...i}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...i})};m.displayName="AlertDialogHeader";let h=e=>{let{className:t,...i}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...i})};h.displayName="AlertDialogFooter";let p=r.forwardRef((e,t)=>{let{className:i,...r}=e;return(0,a.jsx)(s.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold",i),...r})});p.displayName=s.Dx.displayName;let x=r.forwardRef((e,t)=>{let{className:i,...r}=e;return(0,a.jsx)(s.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",i),...r})});x.displayName=s.dk.displayName;let f=r.forwardRef((e,t)=>{let{className:i,...r}=e;return(0,a.jsx)(s.aU,{ref:t,className:(0,n.cn)((0,l.d)(),i),...r})});f.displayName=s.aU.displayName;let g=r.forwardRef((e,t)=>{let{className:i,...r}=e;return(0,a.jsx)(s.$j,{ref:t,className:(0,n.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",i),...r})});g.displayName=s.$j.displayName},5179:function(e,t,i){"use strict";i.d(t,{I:function(){return n}});var a=i(7437),r=i(2265),s=i(1657);let n=r.forwardRef((e,t)=>{let{className:i,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:t,...n})});n.displayName="Input"},9842:function(e,t,i){"use strict";i.d(t,{_:function(){return c}});var a=i(7437),r=i(2265),s=i(6743),n=i(6061),l=i(1657);let o=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,t)=>{let{className:i,...r}=e;return(0,a.jsx)(s.f,{ref:t,className:(0,l.cn)(o(),i),...r})});c.displayName=s.f.displayName},1154:function(e,t,i){"use strict";i.d(t,{deletePostWithUIUpdate:function(){return r}});var a=i(1654);async function r(e,t){return new Promise(async(i,r)=>{try{await Promise.all([a.OQ.from("comments").delete().eq("post_id",e),a.OQ.from("likes").delete().eq("post_id",e)]);let{error:s}=await a.OQ.from("posts").delete().eq("id",e);if(s){r(s);return}if("function"==typeof t){t(e),i(!0);return}i(!0),setTimeout(()=>{try{{let e=window.scrollY||document.documentElement.scrollTop;sessionStorage.setItem("post_delete_scroll",e.toString())}}catch(e){}window.location.reload()},300)}catch(e){r(e)}})}}},function(e){e.O(0,[870,542,658,113,861,749,180,826,243,414,426,485,971,938,744],function(){return e(e.s=9528)}),_N_E=e.O()}]);